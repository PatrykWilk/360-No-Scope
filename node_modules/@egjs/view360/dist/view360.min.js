/*
Copyright (c) 2017 NAVER Corp.
@egjs/view360 project is licensed under the MIT license
@egjs/view360 JavaScript library
https://github.com/naver/egjs-view360
@version 3.2.1-rc
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@egjs/axes"),require("@egjs/component")):"function"==typeof define&&define.amd?define(["exports","@egjs/axes","@egjs/component"],e):e((t.eg=t.eg||{},t.eg.view360={}),t.eg.Axes,t.eg.Component)}(this,function(t,h,e){"use strict";function c(){return(c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function d(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var G="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var i,n=(function(t,e){t.exports=function(){function h(t){return"function"==typeof t}var i=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,e=void 0,r=void 0,s=function(t,e){d[n]=t,d[n+1]=e,2===(n+=2)&&(r?r(f):m())},t="undefined"!=typeof window?window:void 0,o=t||{},a=o.MutationObserver||o.WebKitMutationObserver,u="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),c="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function l(){var t=setTimeout;return function(){return t(f,1)}}var d=new Array(1e3);function f(){for(var t=0;t<n;t+=2){var e=d[t],i=d[t+1];e(i),d[t]=void 0,d[t+1]=void 0}n=0}var _,g,p,v,m=void 0;function y(t,e){var i=this,n=new this.constructor(E);void 0===n[x]&&U(n);var r=i._state;if(r){var o=arguments[r-1];s(function(){return N(r,n,o,i._result)})}else V(i,n,t,e);return n}function w(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(E);return P(e,t),e}m=u?function(){return process.nextTick(f)}:a?(g=0,p=new a(f),v=document.createTextNode(""),p.observe(v,{characterData:!0}),function(){v.data=g=++g%2}):c?((_=new MessageChannel).port1.onmessage=f,function(){return _.port2.postMessage(0)}):void 0===t?function(){try{var t=Function("return this")().require("vertx");return void 0===(e=t.runOnLoop||t.runOnContext)?l():function(){e(f)}}catch(t){return l()}}():l();var x=Math.random().toString(36).substring(2);function E(){}var R=void 0,T=1,I=2,C={error:null};function A(t){try{return t.then}catch(t){return C.error=t,C}}function S(t,e,i,n){try{t.call(e,i,n)}catch(t){return t}}function b(t,e,i){var n,r,o,a;e.constructor===t.constructor&&i===y&&e.constructor.resolve===w?(o=t,(a=e)._state===T?M(o,a._result):a._state===I?D(o,a._result):V(a,void 0,function(t){return P(o,t)},function(t){return D(o,t)})):i===C?(D(t,C.error),C.error=null):void 0===i?M(t,e):h(i)?(n=e,r=i,s(function(e){var i=!1,t=S(r,n,function(t){i||(i=!0,n!==t?P(e,t):M(e,t))},function(t){i||(i=!0,D(e,t))},e._label);!i&&t&&(i=!0,D(e,t))},t)):M(t,e)}function P(t,e){var i,n;t===e?D(t,new TypeError("You cannot resolve a promise with itself")):(n=typeof(i=e),null===i||"object"!==n&&"function"!==n?M(t,e):b(t,e,A(e)))}function O(t){t._onerror&&t._onerror(t._result),L(t)}function M(t,e){t._state===R&&(t._result=e,t._state=T,0!==t._subscribers.length&&s(L,t))}function D(t,e){t._state===R&&(t._state=I,t._result=e,s(O,t))}function V(t,e,i,n){var r=t._subscribers,o=r.length;t._onerror=null,r[o]=e,r[o+T]=i,r[o+I]=n,0===o&&t._state&&s(L,t)}function L(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n=void 0,r=void 0,o=t._result,a=0;a<e.length;a+=3)n=e[a],r=e[a+i],n?N(i,n,r,o):r(o);t._subscribers.length=0}}function N(t,e,i,n){var r=h(i),o=void 0,a=void 0,s=void 0,u=void 0;if(r){if((o=function(t,e){try{return t(e)}catch(t){return C.error=t,C}}(i,n))===C?(u=!0,a=o.error,o.error=null):s=!0,e===o)return void D(e,new TypeError("A promises callback cannot return that same promise."))}else o=n,s=!0;e._state!==R||(r&&s?P(e,o):u?D(e,a):t===T?M(e,o):t===I&&D(e,o))}var F=0;function U(t){t[x]=F++,t._state=void 0,t._result=void 0,t._subscribers=[]}var Q=function(){function t(t,e){this._instanceConstructor=t,this.promise=new t(E),this.promise[x]||U(this.promise),i(e)?(this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?M(this.promise,this._result):(this.length=this.length||0,this._enumerate(e),0===this._remaining&&M(this.promise,this._result))):D(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===R&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(e,t){var i=this._instanceConstructor,n=i.resolve;if(n===w){var r=A(e);if(r===y&&e._state!==R)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(i===z){var o=new i(E);b(o,e,r),this._willSettleAt(o,t)}else this._willSettleAt(new i(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},t.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===R&&(this._remaining--,t===I?D(n,i):this._result[e]=i),0===this._remaining&&M(n,this._result)},t.prototype._willSettleAt=function(t,e){var i=this;V(t,void 0,function(t){return i._settledAt(T,e,t)},function(t){return i._settledAt(I,e,t)})},t}(),z=function(){function e(t){this[x]=F++,this._result=this._state=void 0,this._subscribers=[],E!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(e,t){try{t(function(t){P(e,t)},function(t){D(e,t)})}catch(t){D(e,t)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var i=this.constructor;return h(e)?this.then(function(t){return i.resolve(e()).then(function(){return t})},function(t){return i.resolve(e()).then(function(){throw t})}):this.then(e,e)},e}();return z.prototype.then=y,z.all=function(t){return new Q(this,t).promise},z.race=function(r){var o=this;return i(r)?new o(function(t,e){for(var i=r.length,n=0;n<i;n++)o.resolve(r[n]).then(t,e)}):new o(function(t,e){return e(new TypeError("You must pass an array to race."))})},z.resolve=w,z.reject=function(t){var e=new this(E);return D(e,t),e},z._setScheduler=function(t){r=t},z._setAsap=function(t){s=t},z._asap=s,z.polyfill=function(){var t=void 0;if(void 0!==G)t=G;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var i=null;try{i=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===i&&!e.cast)return}t.Promise=z},z.Promise=z}()}(i={exports:{}},i.exports),i.exports),r="undefined"!=typeof window&&window.Math===Math?window:"undefined"!=typeof self&&self.Math===Math?self:Function("return this")(),o=r.document;r.Float32Array=void 0!==r.Float32Array?r.Float32Array:r.Array;r.Float32Array;var a=r.getComputedStyle,s=(r.navigator.userAgent,"ontouchstart"in r),l="ondevicemotion"in r,f=r.DeviceMotionEvent,_=r.devicePixelRatio,g=function(){for(var t=o.documentElement.style,e=["transform","webkitTransform","msTransform","mozTransform"],i=0,n=e.length;i<n;i++)if(e[i]in t)return e[i];return""}(),p=r.CSS&&r.CSS.supports&&r.CSS.supports("will-change","transform");var v="undefined"!=typeof window&&window||{},m=(v.RegExp,v.navigator),y={browser:[{criteria:"PhantomJS",identity:"PhantomJS"},{criteria:/Whale/,identity:"Whale",versionSearch:"Whale"},{criteria:/Edge/,identity:"Edge",versionSearch:"Edge"},{criteria:/MSIE|Trident|Windows Phone/,identity:"IE",versionSearch:"IEMobile|MSIE|rv"},{criteria:/MiuiBrowser/,identity:"MIUI Browser",versionSearch:"MiuiBrowser"},{criteria:/SamsungBrowser/,identity:"Samsung Internet",versionSearch:"SamsungBrowser"},{criteria:/SAMSUNG /,identity:"Samsung Internet",versionSearch:"Version"},{criteria:/Chrome|CriOS/,identity:"Chrome"},{criteria:/Android/,identity:"Android Browser",versionSearch:"Version"},{criteria:/iPhone|iPad/,identity:"Safari",versionSearch:"Version"},{criteria:"Apple",identity:"Safari",versionSearch:"Version"},{criteria:"Firefox",identity:"Firefox"}],os:[{criteria:/Windows Phone/,identity:"Windows Phone",versionSearch:"Windows Phone"},{criteria:"Windows 2000",identity:"Window",versionAlias:"5.0"},{criteria:/Windows NT/,identity:"Window",versionSearch:"Windows NT"},{criteria:/iPhone|iPad/,identity:"iOS",versionSearch:"iPhone OS|CPU OS"},{criteria:"Mac",versionSearch:"OS X",identity:"MAC"},{criteria:/Android/,identity:"Android"},{criteria:/Tizen/,identity:"Tizen"},{criteria:/Web0S/,identity:"WebOS"}],webview:[{criteria:/iPhone|iPad/,browserVersionSearch:"Version",webviewBrowserVersion:/-1/},{criteria:/iPhone|iPad|Android/,webviewToken:/NAVER|DAUM|; wv/}],defaultString:{browser:{version:"-1",name:"unknown"},os:{version:"-1",name:"unknown"}}};function w(t,e){for(var i=[],n=0;n<t.length;n++)e(t[n])&&i.push(t[n]);return i}var x=void 0;function E(t,e){return e&&e.test?!!e.test(t):-1<t.indexOf(e)}function R(t,e){var i=w(t,function(t){return E(x,t.criteria)})[0];return i&&i.identity||e.name}function T(t,n){return w(t,function(t){var e=t.criteria,i=new RegExp(t.identity,"i").test(n);return!!(e?i&&E(x,e):i)})[0]}function I(t,e){var i=y.defaultString.browser.version,n=new RegExp("("+t+")","i").exec(e);if(!n)return i;var r=n.index,o=n[0];if(-1<r){var a=r+o.length+1;i=e.substring(a).split(" ")[0].replace(/_/g,".").replace(/;|\)/g,"")}return i}function C(t){var e,i;if(t)return I((e=t,(i=T(y.browser,e))||(i={criteria:e,versionSearch:e,identity:e}),i).versionSearch||t,x)}function A(t){var e,i=(e=t,T(y.os,e)||{}),n=y.defaultString.os.version,r=void 0;if(t){if(i.versionAlias)return i.versionAlias;var o=i.versionSearch||t,a=new RegExp("("+o+")\\s([\\d_\\.]+|\\d_0)","i");return a.exec(x)&&(r=a.exec(x)[2].replace(/_/g,".").replace(/;|\)/g,"")),r||n}}function S(){var t=R(y.os,y.defaultString.os);return{name:t,version:A(t)}}function b(){var t,e,i=R(y.browser,y.defaultString.browser);return{name:i,version:C(i),webview:(t=y.webview,e=void 0,function(t,e){for(var i=0;i<t.length;i++)if(e(t[i]))return!0;return!1}(w(t,function(t){return E(x,t.criteria)}),function(t){return e=I(t.browserVersionSearch,x),!(!E(x,t.webviewToken)&&!E(e,t.webviewBrowserVersion))}))}}function P(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:m.userAgent;x=t;var e={os:S(),browser:b(),isMobile:-1!==x.indexOf("Mobi")};return e.browser.name=e.browser.name.toLowerCase(),e.os.name=e.os.name.toLowerCase(),e.os.version=e.os.version.toLowerCase(),"ios"===e.os.name&&e.browser.webview&&(e.browser.version="-1"),e}P.VERSION="2.1.5";var O,M,D=window.MathUtil||{};D.degToRad=Math.PI/180,D.radToDeg=180/Math.PI,D.Vector2=function(t,e){this.x=t||0,this.y=e||0},D.Vector2.prototype={constructor:D.Vector2,set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},subVectors:function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}},D.Vector3=function(t,e,i){this.x=t||0,this.y=e||0,this.z=i||0},D.Vector3.prototype={constructor:D.Vector3,set:function(t,e,i){return this.x=t,this.y=e,this.z=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var t=this.length();if(0!==t){var e=1/t;this.multiplyScalar(e)}else this.x=0,this.y=0,this.z=0;return this},multiplyScalar:function(t){this.x*=t,this.y*=t,this.z*=t},applyQuaternion:function(t){var e=this.x,i=this.y,n=this.z,r=t.x,o=t.y,a=t.z,s=t.w,u=s*e+o*n-a*i,h=s*i+a*e-r*n,c=s*n+r*i-o*e,l=-r*e-o*i-a*n;return this.x=u*s+l*-r+h*-a-c*-o,this.y=h*s+l*-o+c*-r-u*-a,this.z=c*s+l*-a+u*-o-h*-r,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},crossVectors:function(t,e){var i=t.x,n=t.y,r=t.z,o=e.x,a=e.y,s=e.z;return this.x=n*s-r*a,this.y=r*o-i*s,this.z=i*a-n*o,this}},D.Quaternion=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.w=void 0!==n?n:1},D.Quaternion.prototype={constructor:D.Quaternion,set:function(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},setFromEulerXYZ:function(t,e,i){var n=Math.cos(t/2),r=Math.cos(e/2),o=Math.cos(i/2),a=Math.sin(t/2),s=Math.sin(e/2),u=Math.sin(i/2);return this.x=a*r*o+n*s*u,this.y=n*s*o-a*r*u,this.z=n*r*u+a*s*o,this.w=n*r*o-a*s*u,this},setFromEulerYXZ:function(t,e,i){var n=Math.cos(t/2),r=Math.cos(e/2),o=Math.cos(i/2),a=Math.sin(t/2),s=Math.sin(e/2),u=Math.sin(i/2);return this.x=a*r*o+n*s*u,this.y=n*s*o-a*r*u,this.z=n*r*u-a*s*o,this.w=n*r*o+a*s*u,this},setFromAxisAngle:function(t,e){var i=e/2,n=Math.sin(i);return this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(i),this},multiply:function(t){return this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,e){var i=t.x,n=t.y,r=t.z,o=t.w,a=e.x,s=e.y,u=e.z,h=e.w;return this.x=i*h+o*a+n*u-r*s,this.y=n*h+o*s+r*a-i*u,this.z=r*h+o*u+i*s-n*a,this.w=o*h-i*a-n*s-r*u,this},inverse:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this},normalize:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return this.w=0===t?(this.x=0,this.y=0,this.z=0,1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w*t),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var i=this.x,n=this.y,r=this.z,o=this.w,a=o*t.w+i*t.x+n*t.y+r*t.z;if(a<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,a=-a):this.copy(t),1<=a)return this.w=o,this.x=i,this.y=n,this.z=r,this;var s=Math.acos(a),u=Math.sqrt(1-a*a);if(Math.abs(u)<.001)return this.w=.5*(o+this.w),this.x=.5*(i+this.x),this.y=.5*(n+this.y),this.z=.5*(r+this.z),this;var h=Math.sin((1-e)*s)/u,c=Math.sin(e*s)/u;return this.w=o*h+this.w*c,this.x=i*h+this.x*c,this.y=n*h+this.y*c,this.z=r*h+this.z*c,this},setFromUnitVectors:function(t,e){return void 0===O&&(O=new D.Vector3),(M=t.dot(e)+1)<1e-6?(M=0,Math.abs(t.x)>Math.abs(t.z)?O.set(-t.y,t.x,0):O.set(0,-t.z,t.y)):O.crossVectors(t,e),this.x=O.x,this.y=O.y,this.z=O.z,this.w=M,this.normalize(),this}};var V,L,N,F,U,Q=D,z=(Q.MathUtil,window.Util||{});z.MIN_TIMESTEP=.001,z.MAX_TIMESTEP=1,z.base64=function(t,e){return"data:"+t+";base64,"+e},z.clamp=function(t,e,i){return Math.min(Math.max(e,t),i)},z.lerp=function(t,e,i){return t+(e-t)*i},z.race=function(n){return Promise.race?Promise.race(n):new Promise(function(t,e){for(var i=0;i<n.length;i++)n[i].then(t,e)})},z.isIOS=(V=/iPad|iPhone|iPod/.test(navigator.platform),function(){return V}),z.isWebViewAndroid=(L=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome"),function(){return L}),z.isSafari=(N=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),function(){return N}),z.isFirefoxAndroid=(F=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android"),function(){return F}),z.isR7=(U=-1!==navigator.userAgent.indexOf("R7 Build"),function(){return U}),z.isLandscapeMode=function(){var t=90==window.orientation||-90==window.orientation;return z.isR7()?!t:t},z.isTimestampDeltaValid=function(t){return!isNaN(t)&&(!(t<=z.MIN_TIMESTEP)&&!(t>z.MAX_TIMESTEP))},z.getScreenWidth=function(){return Math.max(window.screen.width,window.screen.height)*window.devicePixelRatio},z.getScreenHeight=function(){return Math.min(window.screen.width,window.screen.height)*window.devicePixelRatio},z.requestFullscreen=function(t){if(z.isWebViewAndroid())return!1;if(t.requestFullscreen)t.requestFullscreen();else if(t.webkitRequestFullscreen)t.webkitRequestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else{if(!t.msRequestFullscreen)return!1;t.msRequestFullscreen()}return!0},z.exitFullscreen=function(){if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();else if(document.mozCancelFullScreen)document.mozCancelFullScreen();else{if(!document.msExitFullscreen)return!1;document.msExitFullscreen()}return!0},z.getFullscreenElement=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},z.linkProgram=function(t,e,i,n){var r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e),t.compileShader(r);var o=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(o,i),t.compileShader(o);var a=t.createProgram();for(var s in t.attachShader(a,r),t.attachShader(a,o),n)t.bindAttribLocation(a,n[s],s);return t.linkProgram(a),t.deleteShader(r),t.deleteShader(o),a},z.getProgramUniforms=function(t,e){for(var i={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),r="",o=0;o<n;o++){i[r=t.getActiveUniform(e,o).name.replace("[0]","")]=t.getUniformLocation(e,r)}return i},z.orthoMatrix=function(t,e,i,n,r,o,a){var s=1/(e-i),u=1/(n-r),h=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*u,t[14]=(a+o)*h,t[15]=1,t},z.copyArray=function(t,e){for(var i=0,n=t.length;i<n;i++)e[i]=t[i]},z.isMobile=function(){var t,e=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e},z.extend=function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t},z.safariCssSizeWorkaround=function(t){if(z.isIOS()){var e=t.style.width,i=t.style.height;t.style.width=parseInt(e)+1+"px",t.style.height=parseInt(i)+"px",setTimeout(function(){t.style.width=e,t.style.height=i},100)}window.Util=z,window.canvas=t},z.isDebug=function(){return z.getQueryParameter("debug")},z.getQueryParameter=function(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)").exec(location.search);return null===e?"":decodeURIComponent(e[1].replace(/\+/g," "))},z.frameDataFromPose=function(){var Ot=Math.PI/180,Mt=.25*Math.PI;var Dt=new Float32Array([0,0,0,1]),Vt=new Float32Array([0,0,0]);function n(t,e,i,n,r){var o,a,s,u,h,c,l,d,f,_;o=t,a=n?n.fieldOfView:null,s=r.depthNear,u=r.depthFar,h=Math.tan(a?a.upDegrees*Ot:Mt),c=Math.tan(a?a.downDegrees*Ot:Mt),l=Math.tan(a?a.leftDegrees*Ot:Mt),d=Math.tan(a?a.rightDegrees*Ot:Mt),f=2/(l+d),_=2/(h+c),o[0]=f,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=-(l-d)*f*.5,o[9]=(h-c)*_*.5,o[10]=u/(s-u),o[11]=-1,o[12]=0,o[13]=0,o[14]=u*s/(s-u),o[15]=0;var g,p,v,m,y,w,x,E,R,T,I,C,A,S,b,P,O,M,D,V,L,N,F,U,Q,z,G,W,X,Y,B,k,H,j,q,K,Z,J,$,tt,et,it,nt,rt,ot,at,st,ut,ht,ct,lt,dt,ft,_t,gt,pt,vt,mt,yt,wt,xt,Et,Rt,Tt,It,Ct,At,St,bt=i.orientation||Dt,Pt=i.position||Vt;g=e,v=Pt,m=(p=bt)[0],y=p[1],w=p[2],x=p[3],I=m*(E=m+m),C=m*(R=y+y),A=m*(T=w+w),S=y*R,b=y*T,P=w*T,O=x*E,M=x*R,D=x*T,g[0]=1-(S+P),g[1]=C+D,g[2]=A-M,g[3]=0,g[4]=C-D,g[5]=1-(I+P),g[6]=b+O,g[7]=0,g[8]=A+M,g[9]=b-O,g[10]=1-(I+S),g[11]=0,g[12]=v[0],g[13]=v[1],g[14]=v[2],g[15]=1,n&&(L=V=e,N=n.offset,q=N[0],K=N[1],Z=N[2],V[15]=L===V?(V[12]=L[0]*q+L[4]*K+L[8]*Z+L[12],V[13]=L[1]*q+L[5]*K+L[9]*Z+L[13],V[14]=L[2]*q+L[6]*K+L[10]*Z+L[14],L[3]*q+L[7]*K+L[11]*Z+L[15]):(F=L[0],U=L[1],Q=L[2],z=L[3],G=L[4],W=L[5],X=L[6],Y=L[7],B=L[8],k=L[9],H=L[10],j=L[11],V[0]=F,V[1]=U,V[2]=Q,V[3]=z,V[4]=G,V[5]=W,V[6]=X,V[7]=Y,V[8]=B,V[9]=k,V[10]=H,V[11]=j,V[12]=F*q+G*K+B*Z+L[12],V[13]=U*q+W*K+k*Z+L[13],V[14]=Q*q+X*K+H*Z+L[14],z*q+Y*K+j*Z+L[15])),tt=($=J=e)[0],et=$[1],it=$[2],nt=$[3],rt=$[4],ot=$[5],at=$[6],st=$[7],ut=$[8],ht=$[9],ct=$[10],lt=$[11],dt=$[12],ft=$[13],_t=$[14],gt=$[15],(St=(pt=tt*ot-et*rt)*(At=ct*gt-lt*_t)-(vt=tt*at-it*rt)*(Ct=ht*gt-lt*ft)+(mt=tt*st-nt*rt)*(It=ht*_t-ct*ft)+(yt=et*at-it*ot)*(Tt=ut*gt-lt*dt)-(wt=et*st-nt*ot)*(Rt=ut*_t-ct*dt)+(xt=it*st-nt*at)*(Et=ut*ft-ht*dt))&&(St=1/St,J[0]=(ot*At-at*Ct+st*It)*St,J[1]=(it*Ct-et*At-nt*It)*St,J[2]=(ft*xt-_t*wt+gt*yt)*St,J[3]=(ct*wt-ht*xt-lt*yt)*St,J[4]=(at*Tt-rt*At-st*Rt)*St,J[5]=(tt*At-it*Tt+nt*Rt)*St,J[6]=(_t*mt-dt*xt-gt*vt)*St,J[7]=(ut*xt-ct*mt+lt*vt)*St,J[8]=(rt*Ct-ot*Tt+st*Et)*St,J[9]=(et*Tt-tt*Ct-nt*Et)*St,J[10]=(dt*wt-ft*mt+gt*pt)*St,J[11]=(ht*mt-ut*wt-lt*pt)*St,J[12]=(ot*Rt-rt*It-at*Et)*St,J[13]=(tt*It-et*Rt+it*Et)*St,J[14]=(ft*vt-dt*yt-_t*pt)*St,J[15]=(ut*yt-ht*vt+ct*pt)*St)}return function(t,e,i){return!(!t||!e)&&(t.pose=e,t.timestamp=e.timestamp,n(t.leftProjectionMatrix,t.leftViewMatrix,e,i.getEyeParameters("left"),i),n(t.rightProjectionMatrix,t.rightViewMatrix,e,i.getEyeParameters("right"),i),!0)}}(),z.isInsideCrossDomainIFrame=function(){var t=window.self!==window.top,e=z.getDomainFromUrl(document.referrer),i=z.getDomainFromUrl(window.location.href);return t&&e!==i},z.getDomainFromUrl=function(t){return(-1<t.indexOf("://")?t.split("/")[2]:t.split("/")[0]).split(":")[0]};var W=z;function X(t){this.predictionTimeS=t,this.previousQ=new Q.Quaternion,this.previousTimestampS=null,this.deltaQ=new Q.Quaternion,this.outQ=new Q.Quaternion}X.prototype.getPrediction=function(t,e,i){if(!this.previousTimestampS)return this.previousQ.copy(t),this.previousTimestampS=i,t;var n=new Q.Vector3;n.copy(e),n.normalize();var r=e.length();if(r<20*Q.degToRad)return W.isDebug()&&console.log("Moving slowly, at %s deg/s: no prediction",(Q.radToDeg*r).toFixed(1)),this.outQ.copy(t),this.previousQ.copy(t),this.outQ;this.previousTimestampS;var o=r*this.predictionTimeS;return this.deltaQ.setFromAxisAngle(n,o),this.outQ.copy(this.previousQ),this.outQ.multiply(this.deltaQ),this.previousQ.copy(t),this.previousTimestampS=i,this.outQ};var Y=X,B={};B.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array;var k=Math.PI/180;B.toRadian=function(t){return t*k},B.toDegree=function(t){return t/k},B.EPSILON=1e-4;var H={create:function(){var t=new B.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t},fromValues:function(t,e,i){var n=new B.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},set:function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},scale:function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},subtract:function(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t},length:function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},normalize:function(t,e){var i=e[0],n=e[1],r=e[2],o=i*i+n*n+r*r;return 0<o&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},cross:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[0],s=i[1],u=i[2];return t[0]=r*u-o*s,t[1]=o*a-n*u,t[2]=n*s-r*a,t},transformQuat:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=i[0],s=i[1],u=i[2],h=i[3],c=h*n+s*o-u*r,l=h*r+u*n-a*o,d=h*o+a*r-s*n,f=-a*n-s*r-u*o;return t[0]=c*h+f*-a+l*-u-d*-s,t[1]=l*h+f*-s+d*-a-c*-u,t[2]=d*h+f*-u+c*-s-l*-a,t},rotateZ:function(t,e,i,n){var r=[],o=[];return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],o[0]=r[0]*Math.cos(n)-r[1]*Math.sin(n),o[1]=r[0]*Math.sin(n)+r[1]*Math.cos(n),o[2]=r[2],t[0]=o[0]+i[0],t[1]=o[1]+i[1],t[2]=o[2]+i[2],t}},j={copy:function(t,e){return t[0]=e[0],t[1]=e[1],t}},q={create:function(){var t=new B.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},clone:function(t){var e=new B.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},fromValues:function(t,e,i,n){var r=new B.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=n,r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},setAxisAngle:function(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t},multiply:function(t,e,i){var n=e[0],r=e[1],o=e[2],a=e[3],s=i[0],u=i[1],h=i[2],c=i[3];return t[0]=n*c+a*s+r*h-o*u,t[1]=r*c+a*u+o*s-n*h,t[2]=o*c+a*h+n*u-r*s,t[3]=a*c-n*s-r*u-o*h,t},rotateX:function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=n*u+a*s,t[1]=r*u+o*s,t[2]=o*u-r*s,t[3]=a*u-n*s,t},rotateY:function(t,e,i){i*=.5;var n=e[0],r=e[1],o=e[2],a=e[3],s=Math.sin(i),u=Math.cos(i);return t[0]=n*u-o*s,t[1]=r*u+a*s,t[2]=o*u+n*s,t[3]=a*u-r*s,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},normalize:function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i*i+n*n+r*r+o*o;return 0<a&&(a=1/Math.sqrt(a),t[0]=i*a,t[1]=n*a,t[2]=r*a,t[3]=o*a),t},equals:function(t,e){var i=t[0],n=t[1],r=t[2],o=t[3],a=e[0],s=e[1],u=e[2],h=e[3];return Math.abs(i-a)<=B.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-s)<=B.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-u)<=B.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-h)<=B.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}},K={};K.create=function(){var t=new B.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},K.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},K.rotateX=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[4],a=e[5],s=e[6],u=e[7],h=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+h*n,t[5]=a*r+c*n,t[6]=s*r+l*n,t[7]=u*r+d*n,t[8]=h*r-o*n,t[9]=c*r-a*n,t[10]=l*r-s*n,t[11]=d*r-u*n,t},K.rotateY=function(t,e,i){var n=Math.sin(i),r=Math.cos(i),o=e[0],a=e[1],s=e[2],u=e[3],h=e[8],c=e[9],l=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-h*n,t[1]=a*r-c*n,t[2]=s*r-l*n,t[3]=u*r-d*n,t[8]=o*n+h*r,t[9]=a*n+c*r,t[10]=s*n+l*r,t[11]=u*n+d*r,t},K.fromQuat=function(t,e){var i=e[0],n=e[1],r=e[2],o=e[3],a=i+i,s=n+n,u=r+r,h=i*a,c=n*a,l=n*s,d=r*a,f=r*s,_=r*u,g=o*a,p=o*s,v=o*u;return t[0]=1-l-_,t[1]=c+v,t[2]=d-p,t[3]=0,t[4]=c-v,t[5]=1-h-_,t[6]=f+g,t[7]=0,t[8]=d+p,t[9]=f-g,t[10]=1-h-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},K.perspective=function(t,e,i,n,r){var o=1/Math.tan(e/2),a=1/(n-r);return t[0]=o/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*a,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*a,t[15]=0,t};var Z={isPowerOfTwo:function(t){return t&&0==(t&t-1)}};Z.extractPitchFromQuat=function(t){var e,i,n=(e=t,i=H.fromValues(0,0,1),H.transformQuat(i,i,e),i);return-1*Math.atan2(n[1],Math.sqrt(Math.pow(n[0],2)+Math.pow(n[2],2)))};var J={PITCH_DELTA:1,YAW_DELTA_BY_ROLL:2,YAW_DELTA_BY_YAW:3};J[J.PITCH_DELTA]={targetAxis:[0,1,0],meshPoint:[0,0,1]},J[J.YAW_DELTA_BY_ROLL]={targetAxis:[0,1,0],meshPoint:[1,0,0]},J[J.YAW_DELTA_BY_YAW]={targetAxis:[1,0,0],meshPoint:[0,0,1]},Z.getRotationDelta=function(t,e,i){var n=H.fromValues(J[i].targetAxis[0],J[i].targetAxis[1],J[i].targetAxis[2]),r=J[i].meshPoint,o=q.clone(t),a=q.clone(e);q.normalize(o,o),q.normalize(a,a);var s=H.fromValues(0,0,1),u=H.fromValues(0,0,1);H.transformQuat(s,s,o),H.transformQuat(u,u,a),H.transformQuat(n,n,a);var h,c=0<H.dot(n,H.cross(H.create(),s,u))?1:-1,l=H.fromValues(r[0],r[1],r[2]);h=i!==J.YAW_DELTA_BY_YAW?H.fromValues(0,c,0):H.fromValues(c,0,0),H.transformQuat(l,l,a),H.transformQuat(h,h,a);var d=l,f=h,_=H.create();H.cross(_,d,f),H.normalize(_,_);var g=_[0],p=_[1],v=_[2];u=H.fromValues(r[0],r[1],r[2]),H.transformQuat(u,u,a),s=H.fromValues(r[0],r[1],r[2]),H.transformQuat(s,s,o);var m=Math.abs(s[0]*g+s[1]*p+s[2]*v),y=H.create();H.subtract(y,s,H.scale(H.create(),_,m));var w=(y[0]*u[0]+y[1]*u[1]+y[2]*u[2])/(H.length(y)*H.length(u));1<w&&(w=1);var x=Math.acos(w),E=H.cross(H.create(),u,y);m=g*E[0]+p*E[1]+v*E[2];var R=x*(i!==J.YAW_DELTA_BY_YAW?0<m?1:-1:m<0?1:-1)*c;return B.toDegree(R)};var $=function(e){function t(){var t;return(t=e.call(this)||this)._onDeviceMotion=t._onDeviceMotion.bind(u(u(t))),t._onDeviceOrientation=t._onDeviceOrientation.bind(u(u(t))),t._onChromeWithoutDeviceMotion=t._onChromeWithoutDeviceMotion.bind(u(u(t))),t.isWithoutDeviceMotion=function(){var t=!1,e=P(),i=e.browser.version;if("chrome"===e.browser.name&&65===parseInt(i,10)){var n=i.split("."),r=n[2],o=n[3];t=3325===parseInt(r,10)&&parseInt(o,10)<148}return t}(),t.isAndroid="android"===P().os.name,t.stillGyroVec=H.create(),t.rawGyroVec=H.create(),t.adjustedGyroVec=H.create(),t._timer=null,t.lastDevicemotionTimestamp=0,t._isEnabled=!1,t.enable(),t}d(t,e);var i=t.prototype;return i._onChromeWithoutDeviceMotion=function(t){var e=t.alpha,i=t.beta,n=t.gamma;null!==e&&(e=(e||0)*Math.PI/180,i=(i||0)*Math.PI/180,n=(n||0)*Math.PI/180,this.trigger("devicemotion",{inputEvent:{deviceorientation:{alpha:e,beta:i,gamma:-n}}}))},i._onDeviceOrientation=function(){var t=this;this._timer&&clearTimeout(this._timer),this._timer=setTimeout(function(){(new Date).getTime()-t.lastDevicemotionTimestamp<200&&H.copy(t.stillGyroVec,t.rawGyroVec)},200)},i._onDeviceMotion=function(t){var e=!(null==t.rotationRate.alpha),i=!(null==t.accelerationIncludingGravity.x);if(0!==t.interval&&e&&i){var n=c({},t);n.interval=t.interval,n.timeStamp=t.timeStamp,n.type=t.type,n.rotationRate={alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma},n.accelerationIncludingGravity={x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.z},n.acceleration={x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.z},this.isAndroid&&(H.set(this.rawGyroVec,t.rotationRate.alpha||0,t.rotationRate.beta||0,t.rotationRate.gamma||0),H.subtract(this.adjustedGyroVec,this.rawGyroVec,this.stillGyroVec),this.lastDevicemotionTimestamp=(new Date).getTime(),n.adjustedRotationRate={alpha:this.adjustedGyroVec[0],beta:this.adjustedGyroVec[1],gamma:this.adjustedGyroVec[2]}),this.trigger("devicemotion",{inputEvent:n})}},i.enable=function(){this.isAndroid&&r.addEventListener("deviceorientation",this._onDeviceOrientation),this.isWithoutDeviceMotion?r.addEventListener("deviceorientation",this._onChromeWithoutDeviceMotion):r.addEventListener("devicemotion",this._onDeviceMotion),this._isEnabled=!0},i.disable=function(){r.removeEventListener("deviceorientation",this._onDeviceOrientation),r.removeEventListener("deviceorientation",this._onChromeWithoutDeviceMotion),r.removeEventListener("devicemotion",this._onDeviceMotion),this._isEnabled=!1},t}(e);function tt(t,e){this.set(t,e)}tt.prototype.set=function(t,e){this.sample=t,this.timestampS=e},tt.prototype.copy=function(t){this.set(t.sample,t.timestampS)};var et=tt;function it(t){this.kFilter=t,this.currentAccelMeasurement=new et,this.currentGyroMeasurement=new et,this.previousGyroMeasurement=new et,W.isIOS()?this.filterQ=new Q.Quaternion(-1,0,0,1):this.filterQ=new Q.Quaternion(1,0,0,1),this.previousFilterQ=new Q.Quaternion,this.previousFilterQ.copy(this.filterQ),this.accelQ=new Q.Quaternion,this.isOrientationInitialized=!1,this.estimatedGravity=new Q.Vector3,this.measuredGravity=new Q.Vector3,this.gyroIntegralQ=new Q.Quaternion}it.prototype.addAccelMeasurement=function(t,e){this.currentAccelMeasurement.set(t,e)},it.prototype.addGyroMeasurement=function(t,e){this.currentGyroMeasurement.set(t,e);var i=e-this.previousGyroMeasurement.timestampS;W.isTimestampDeltaValid(i)&&this.run_(),this.previousGyroMeasurement.copy(this.currentGyroMeasurement)},it.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,e=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(e),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(e);var i=new Q.Quaternion;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n=new Q.Quaternion;n.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),n.inverse(),W.isDebug()&&console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",Q.radToDeg*W.getQuaternionAngle(n),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1));var r=new Q.Quaternion;r.copy(this.filterQ),r.multiply(n),this.filterQ.slerp(r,1-this.kFilter),this.previousFilterQ.copy(this.filterQ)},it.prototype.getOrientation=function(){return this.filterQ},it.prototype.accelToQuaternion_=function(t){var e=new Q.Vector3;e.copy(t),e.normalize();var i=new Q.Quaternion;return i.setFromUnitVectors(new Q.Vector3(0,0,-1),e),i.inverse(),i},it.prototype.gyroToQuaternionDelta_=function(t,e){var i=new Q.Quaternion,n=new Q.Vector3;return n.copy(t),n.normalize(),i.setFromAxisAngle(n,t.length()*e),i};var nt=it;nt.prototype.run_=function(){if(!this.isOrientationInitialized)return this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample),this.previousFilterQ.copy(this.accelQ),void(this.isOrientationInitialized=!0);var t=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,e=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,t);this.gyroIntegralQ.multiply(e),this.filterQ.copy(this.previousFilterQ),this.filterQ.multiply(e);var i=new Q.Quaternion;i.copy(this.filterQ),i.inverse(),this.estimatedGravity.set(0,0,-1),this.estimatedGravity.applyQuaternion(i),this.estimatedGravity.normalize(),this.measuredGravity.copy(this.currentAccelMeasurement.sample),this.measuredGravity.normalize();var n=new Q.Quaternion;n.setFromUnitVectors(this.estimatedGravity,this.measuredGravity),n.inverse();var r=new Q.Quaternion;r.copy(this.filterQ),r.multiply(n),this.filterQ.slerp(r,1-this.kFilter),this.previousFilterQ.copy(this.filterQ),this.isFilterQuaternionInitialized||(this.isFilterQuaternionInitialized=!0)},nt.prototype.getOrientation=function(){return this.isFilterQuaternionInitialized?this.filterQ:null};var rt=P(),ot=function(e){function t(){var t;return(t=e.call(this)||this).deviceMotion=new $,t.accelerometer=new Q.Vector3,t.gyroscope=new Q.Vector3,t._onDeviceMotionChange=t._onDeviceMotionChange.bind(u(u(t))),t._onScreenOrientationChange=t._onScreenOrientationChange.bind(u(u(t))),t.filter=new nt(.98),t.posePredictor=new Y(.04),t.filterToWorldQ=new Q.Quaternion,t.isFirefoxAndroid=W.isFirefoxAndroid(),t.isIOS=W.isIOS(),t.isChromeUsingDegrees="chrome"===rt.browser.name&&66<=parseInt(rt.browser.version,10),t._isEnabled=!1,t.isIOS?t.filterToWorldQ.setFromAxisAngle(new Q.Vector3(1,0,0),Math.PI/2):t.filterToWorldQ.setFromAxisAngle(new Q.Vector3(1,0,0),-Math.PI/2),t.inverseWorldToScreenQ=new Q.Quaternion,t.worldToScreenQ=new Q.Quaternion,t.originalPoseAdjustQ=new Q.Quaternion,t.originalPoseAdjustQ.setFromAxisAngle(new Q.Vector3(0,0,1),-r.orientation*Math.PI/180),t._setScreenTransform(),W.isLandscapeMode()&&t.filterToWorldQ.multiply(t.inverseWorldToScreenQ),t.resetQ=new Q.Quaternion,t.deviceMotion.on("devicemotion",t._onDeviceMotionChange),t.enable(),t}d(t,e);var i=t.prototype;return i.enable=function(){this.isEnabled()||(this.deviceMotion.enable(),this._isEnabled=!0,r.addEventListener("orientationchange",this._onScreenOrientationChange))},i.disable=function(){this.isEnabled()&&(this.deviceMotion.disable(),this._isEnabled=!1,r.removeEventListener("orientationchange",this._onScreenOrientationChange))},i.isEnabled=function(){return this._isEnabled},i.destroy=function(){this.disable(),this.deviceMotion=null},i._triggerChange=function(){var t=this.getOrientation();t&&(this._prevOrientation?q.equals(this._prevOrientation,t)||this.trigger("change",{quaternion:t}):this._prevOrientation=t)},i.getOrientation=function(){var t;if(this.deviceMotion.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){return(new Q.Quaternion).setFromAxisAngle(new Q.Vector3(0,1,0),-this._alpha)}.bind(this)(),t=this._deviceOrientationQ;var e=new Q.Quaternion;e.copy(t),e.multiply(this.filterToWorldQ),e.multiply(this.resetQ),e.multiply(this.worldToScreenQ),e.multiplyQuaternions(this.deviceOrientationFixQ,e);var i=q.fromValues(e.x,e.y,e.z,e.w);return q.normalize(i,i)}if(!(t=this.filter.getOrientation()))return null;var n=this._convertFusionToPredicted(t),r=q.fromValues(n.x,n.y,n.z,n.w);return q.normalize(r,r)},i._convertFusionToPredicted=function(t){this.predictedQ=this.posePredictor.getPrediction(t,this.gyroscope,this.previousTimestampS);var e=new Q.Quaternion;return e.copy(this.filterToWorldQ),e.multiply(this.resetQ),e.multiply(this.predictedQ),e.multiply(this.worldToScreenQ),e},i._onDeviceMotionChange=function(t){var e=t.inputEvent,i=e.deviceorientation,n=e,r=n.accelerationIncludingGravity,o=n.adjustedRotationRate||n.rotationRate,a=n.timeStamp/1e3;i?(this._alpha||(this._alpha=i.alpha),this._deviceOrientationQ=this._deviceOrientationQ||new Q.Quaternion,this._deviceOrientationQ.setFromEulerYXZ(i.beta,i.alpha,i.gamma),this._triggerChange()):(this.isFirefoxAndroid&&(a/=1e3),this.accelerometer.set(-r.x,-r.y,-r.z),this.gyroscope.set(o.alpha,o.beta,o.gamma),(this.isIOS||this.isFirefoxAndroid||this.isChromeUsingDegrees)&&this.gyroscope.multiplyScalar(Math.PI/180),this.filter.addAccelMeasurement(this.accelerometer,a),this.filter.addGyroMeasurement(this.gyroscope,a),this._triggerChange(),this.previousTimestampS=a)},i._onScreenOrientationChange=function(t){this._setScreenTransform(r.orientation)},i._setScreenTransform=function(){switch(this.worldToScreenQ.set(0,0,0,1),r.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Q.Vector3(0,0,1),-.5*Math.PI);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Q.Vector3(0,0,1),.5*Math.PI);break;case 180:this.worldToScreenQ.setFromAxisAngle(new Q.Vector3(0,0,1),-1*Math.PI)}this.inverseWorldToScreenQ.copy(this.worldToScreenQ),this.inverseWorldToScreenQ.inverse()},t}(e);var at=function(n){function t(t,e){var i;return(i=n.call(this)||this).element=t,i._prevQuaternion=null,i._quaternion=null,i.fusionPoseSensor=null,i.options=c({scale:1,threshold:0},e),i._onPoseChange=i._onPoseChange.bind(u(u(i))),i}d(t,n);var e=t.prototype;return e.mapAxes=function(t){this.axes=t},e.connect=function(t){return this.observer||(this.observer=t,this.fusionPoseSensor=new ot,this.fusionPoseSensor.enable(),this._attachEvent()),this},e.disconnect=function(){return this.observer&&(this._dettachEvent(),this.fusionPoseSensor.disable(),this.fusionPoseSensor.destroy(),this.fusionPoseSensor=null,this.observer=null),this},e.destroy=function(){this.disconnect(),this.element=null,this.options=null,this.axes=null,this._prevQuaternion=null,this._quaternion=null},e._onPoseChange=function(t){if(!this._prevQuaternion)return this._prevQuaternion=q.clone(t.quaternion),void(this._quaternion=q.clone(t.quaternion));var n,e,i,r,o,a;q.copy(this._prevQuaternion,this._quaternion),q.copy(this._quaternion,t.quaternion),this.observer.change(this,t,(n=this.axes,[(r=this._prevQuaternion,o=this._quaternion,a=Z.getRotationDelta(r,o,J.YAW_DELTA_BY_YAW),Z.getRotationDelta(r,o,J.YAW_DELTA_BY_ROLL)*Math.sin(Z.extractPitchFromQuat(o))+a),(e=this._prevQuaternion,i=this._quaternion,Z.getRotationDelta(e,i,J.PITCH_DELTA))].reduce(function(t,e,i){return n[i]&&(t[n[i]]=e),t},{})))},e._attachEvent=function(){this.fusionPoseSensor.on("change",this._onPoseChange)},e._dettachEvent=function(){this.fusionPoseSensor.off("change",this._onPoseChange)},t}(e),st=null,ut=0,ht=function(){function t(){if(ut++,st)return st;(st=this)._onDeviceOrientation=this._onDeviceOrientation.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._spinR=0,this._screenOrientationAngle=0,r.addEventListener("deviceorientation",this._onDeviceOrientation),r.addEventListener("orientationchange",this._onOrientationChange)}var e=t.prototype;return e._onDeviceOrientation=function(t){if(null!==t.beta&&null!==t.gamma){var e=B.toRadian(t.beta),i=B.toRadian(t.gamma);this._spinR=Math.atan2(Math.cos(e)*Math.sin(i),Math.sin(e))}},e._onOrientationChange=function(t){r.screen&&r.screen.orientation&&void 0!==r.screen.orientation.angle?this._screenOrientationAngle=screen.orientation.angle:void 0!==r.orientation&&(this._screenOrientationAngle=0<=r.orientation?r.orientation:360+r.orientation)},e.getRadian=function(){return this._spinR+B.toRadian(this._screenOrientationAngle)},e.unref=function(){0<--ut||(r.removeEventListener("deviceorientation",this._onDeviceOrientation),r.removeEventListener("orientationchange",this._onOrientationChange),this._spinR=0,this._screenOrientationAngle=0,st=null,ut=0)},t}(),ct=function(s){function t(t,e){var i;return(i=s.call(this,t,e)||this)._useRotation=!1,i._screenRotationAngle=null,i.setUseRotation(!(!e||!e.useRotation)),i._userDirection=h.DIRECTION_ALL,i}d(t,s);var e=t.prototype;return e.setUseRotation=function(t){this._useRotation=t,this._screenRotationAngle&&(this._screenRotationAngle.unref(),this._screenRotationAngle=null),this._useRotation&&(this._screenRotationAngle=new ht)},e.connect=function(t){this._userDirection=this._direction,this._useRotation&&this._direction&h.DIRECTION_ALL&&(this._direction=h.DIRECTION_ALL),s.prototype.connect.call(this,t)},e.getOffset=function(t,e){if(!1===this._useRotation)return s.prototype.getOffset.call(this,t,e);var i=s.prototype.getOffset.call(this,t,[!0,!0]),n=[0,0],r=this._screenRotationAngle.getRadian(),o=Math.cos(r),a=Math.sin(r);return n[0]=i[0]*o-i[1]*a,n[1]=i[1]*o+i[0]*a,this._userDirection&h.DIRECTION_HORIZONTAL?this._userDirection&h.DIRECTION_VERTICAL||(n[1]=0):n[0]=0,n},e.destroy=function(){this._useRotation&&this._screenRotationAngle&&this._screenRotationAngle.unref(),s.prototype.destroy.call(this)},t}(h.PanInput),lt=H.fromValues(0,0,0),dt=H.fromValues(1,0,0),ft=H.fromValues(0,1,0),_t=function(t){function e(){var e;return(e=t.call(this)||this)._screenRotationAngle=new ht,e._fusionPoseSensor=new ot,e._quaternion=q.create(),e._fusionPoseSensor.enable(),e._fusionPoseSensor.on("change",function(t){e._quaternion=t.quaternion,e.trigger("change",{isTrusted:!0})}),e}d(e,t);var i=e.prototype;return i.getCombinedQuaternion=function(t,e){var i=this._screenRotationAngle.getRadian(),n=H.rotateZ(H.create(),dt,lt,i),r=q.setAxisAngle(q.create(),ft,B.toRadian(-t)),o=q.setAxisAngle(q.create(),n,B.toRadian(-e)),a=q.conjugate(q.create(),this._quaternion),s=q.multiply(q.create(),o,a);return q.multiply(s,s,r),s},i.destroy=function(){this.off(),this._fusionPoseSensor&&(this._fusionPoseSensor.off(),this._fusionPoseSensor.destroy(),this._fusionPoseSensor=null),this._screenRotationAngle&&(this._screenRotationAngle.unref(),this._screenRotationAngle=null)},e}(e),gt=[.2,.2],pt={NONE:"none",YAWPITCH:"yawPitch",VR:"VR"},vt="3.2.1-rc",mt=[-180,180],yt=[-90,90],wt=[-180,180],xt=function(){var t=function(n){function u(t){var e;e=n.call(this)||this;var i=c({element:null,yaw:0,pitch:0,fov:65,showPolePoint:!1,useZoom:!0,useKeyboard:!0,gyroMode:pt.YAWPITCH,touchDirection:6,yawRange:mt,pitchRange:yt,fovRange:[30,110],aspectRatio:1},t);return e._element=i.element,e._initialFov=i.fov,e._enabled=!1,e._isAnimating=!1,e._deviceQuaternion=null,e._initAxes(i),e.option(i),e}d(u,n);var t=u.prototype;return t._initAxes=function(t){var e=this,i=this._updateYawRange(t.yawRange,t.fov,t.aspectRatio),n=this._updatePitchRange(t.pitchRange,t.fov,t.showPolePoint),r=t.gyroMode===pt.VR;this.axesPanInput=new ct(this._element,{useRotation:r}),this.axesWheelInput=new h.WheelInput(this._element,{scale:-4}),this.axesTiltMotionInput=null,this.axesPinchInput=s?new h.PinchInput(this._element,{scale:-1}):null,this.axesMoveKeyInput=new h.MoveKeyInput(this._element,{scale:[-6,6]}),this.axes=new h({yaw:{range:i,circular:u.isCircular(i),bounce:[0,0]},pitch:{range:n,circular:u.isCircular(n),bounce:[0,0]},fov:{range:t.fovRange,circular:[!1,!1],bounce:[0,0]}},{deceleration:.0014,maximumDuration:1e3},{yaw:t.yaw,pitch:t.pitch,fov:t.fov}).on({hold:function(t){e.axes.options.maximumDuration=1e3,e.trigger("hold",{isTrusted:t.isTrusted})},change:function(t){0!==t.delta.fov&&(e._updateControlScale(t),e.updatePanScale()),e._triggerChange(t)},release:function(t){e._triggerChange(t)},animationStart:function(t){},animationEnd:function(t){e.trigger("animationEnd",{isTrusted:t.isTrusted})}})},t.updatePanScale=function(t){void 0===t&&(t={});var e=this.axes.get().fov,i=t.height||parseInt(a(this._element).height,10),n=gt[0]*e/this._initialFov*320/i;return this.axesPanInput.options.scale=[n,n],this.axes.options.deceleration=.0014*e/110,this},t.option=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];var n=e.length;if(0===n)return this._getOptions();if(1===n&&"string"==typeof e[0])return this._getOptions(e[0]);var r=c({},this.options),o={},a=[];return 1===n?(a=Object.keys(e[0]),o=c({},e[0])):2<=n&&(a.push(e[0]),o[e[0]]=e[1]),this._setOptions(this._getValidatedOptions(o)),this._applyOptions(a,r),this},t._getValidatedOptions=function(t){return t.yawRange&&(t.yawRange=this._getValidYawRange(t.yawRange,t.fov,t.aspectRatio)),t.pitchRange&&(t.pitchRange=this._getValidPitchRange(t.pitchRange,t.fov)),t},t._getOptions=function(t){var e;return"string"==typeof t?e=this.options[t]:0===arguments.length&&(e=this.options),e},t._setOptions=function(t){for(var e in t)this.options[e]=t[e]},t._applyOptions=function(t,e){if(t.some(function(t){return"showPolePoint"===t||"fov"===t||"aspectRatio"===t||"yawRange"===t||"pitchRange"===t})&&(this._updateControlScale(),0<=t.indexOf("fov")&&this.updatePanScale()),t.some(function(t){return"fovRange"===t})){var i=this.options.fovRange.map(function(t){return+t.toFixed(5)}),n=this.axes.get().fov,r=this.axes.get().fov;j.copy(this.axes.axis.fov.range,i),r<i[0]?r=i[0]:n>i[1]&&(r=i[1]),n!==r&&(this.axes.setTo({fov:r},0),this._updateControlScale(),this.updatePanScale())}if(t.some(function(t){return"gyroMode"===t})&&l){var o=this.options.gyroMode===pt.VR,a=this.options.gyroMode===pt.YAWPITCH;this.axesTiltMotionInput&&(this.axes.disconnect(this.axesTiltMotionInput),this.axesTiltMotionInput.destroy(),this.axesTiltMotionInput=null),this._deviceQuaternion&&(this._deviceQuaternion.destroy(),this._deviceQuaternion=null),o?this._initDeviceQuaternion():a&&(this.axesTiltMotionInput=new at(this._element),this.axes.connect(["yaw","pitch"],this.axesTiltMotionInput)),this.axesPanInput.setUseRotation(o)}t.some(function(t){return"useKeyboard"===t})&&(this.options.useKeyboard?this.axes.connect(["yaw","pitch"],this.axesMoveKeyInput):this.axes.disconnect(this.axesMoveKeyInput));if(t.some(function(t){return"useZoom"===t})){var s=this.options.useZoom;this.axes.disconnect(this.axesWheelInput),s&&this.axes.connect(["fov"],this.axesWheelInput)}this._togglePinchInputByOption(this.options.touchDirection,this.options.useZoom),t.some(function(t){return"touchDirection"===t})&&this._enabled&&this._enableTouch(this.options.touchDirection)},t._togglePinchInputByOption=function(t,e){this.axesPinchInput&&(this.axes.disconnect(this.axesPinchInput),e&&6===t&&-1===this.axes._inputs.indexOf(this.axesPinchInput)&&this.axes.connect(["fov"],this.axesPinchInput))},t._enableTouch=function(t){this.axesPanInput&&this.axes.disconnect(this.axesPanInput);var e=2&t?"yaw":null,i=4&t?"pitch":null;this.axes.connect([e,i],this.axesPanInput)},t._initDeviceQuaternion=function(){var e=this;this._deviceQuaternion=new _t,this._deviceQuaternion.on("change",function(t){e._triggerChange(t)})},t._getValidYawRange=function(t,e,i){var n=u.adjustAspectRatio(i||this.options.aspectRatio||1),r=(e||this.axes.get().fov)*n;return t[1]-t[0]>=r?t:this.options.yawRange||mt},t._getValidPitchRange=function(t,e){var i=e||this.axes.get().fov;return t[1]-t[0]>=i?t:this.options.pitchRange||yt},u.isCircular=function(t){return t[1]-t[0]<360?[!1,!1]:[!0,!0]},t._updateControlScale=function(t){var e=this.options,i=this.axes.get().fov,n=this._updatePitchRange(e.pitchRange,i,e.showPolePoint),r=this._updateYawRange(e.yawRange,i,e.aspectRatio),o=this.axes.get(),a=o.yaw,s=o.pitch;return j.copy(this.axes.axis.yaw.range,r),j.copy(this.axes.axis.pitch.range,n),this.axes.axis.yaw.circular=u.isCircular(r),this.axes.axis.pitch.circular=u.isCircular(n),a<r[0]?a=r[0]:a>r[1]&&(a=r[1]),s<n[0]?s=n[0]:s>n[1]&&(s=n[1]),t&&t.set({yaw:a,pitch:s}),this.axes.setTo({yaw:a,pitch:s},0),this},t._updatePitchRange=function(t,e,i){if(this.options.gyroMode===pt.VR)return wt;var n=t[1]-t[0],r=e/2;return i&&!(n<180)?t.map(function(t){return+t.toFixed(5)}):[t[0]+r,t[1]-r].map(function(t){return+t.toFixed(5)})},t._updateYawRange=function(t,e,i){if(this.options.gyroMode===pt.VR)return mt;var n=t[1]-t[0];if(360<=n)return t.map(function(t){return+t.toFixed(5)});var r=1,o=e/2*u.adjustAspectRatio(i);return 290<n?r=.794:125<n&&(r=.98),[t[0]*r+o,t[1]*r-o].map(function(t){return+t.toFixed(5)})},t._triggerChange=function(t){var e=this.axes.get(),i=this.options,n={targetElement:i.element,isTrusted:t.isTrusted};n.yaw=e.yaw,n.pitch=e.pitch,n.fov=e.fov,i.gyroMode===pt.VR&&this._deviceQuaternion&&(n.quaternion=this._deviceQuaternion.getCombinedQuaternion(e.yaw,e.pitch)),this.trigger("change",n)},u.adjustAspectRatio=function(t){for(var e=[.52,.54,.563,.57,.584,.59,.609,.67,.702,.72,.76,.78,.82,.92,.97,1,1.07,1.14,1.19,1.25,1.32,1.38,1.4,1.43,1.53,1.62,1.76,1.77,1.86,1.96,2.26,2.3,2.6,3,5,6],i=[.51,.54,.606,.56,.628,.63,.647,.71,.736,.757,.78,.77,.8,.89,.975,1,1.07,1.1,1.15,1.18,1.22,1.27,1.3,1.33,1.39,1.45,1.54,1.55,1.58,1.62,1.72,1.82,1.92,2,2.24,2.3],n=-1,r=0;r<e.length-1;r++)if(e[r]<=t&&t<=e[r+1]){n=r;break}if(-1===n)return t<e[0]?i[0]:i[i[0].length-1];var o=e[n];return u.lerp(i[n],i[n+1],(t-o)/(e[n+1]-o))},u.lerp=function(t,e,i){return t+i*(e-t)},t.enable=function(){return this._enabled||(this._enabled=!0,this._applyOptions(Object.keys(this.options),this.options),this.updatePanScale()),this},t.disable=function(t){return this._enabled&&(t||this._resetOrientation(),this.axes.disconnect(),this._enabled=!1),this},t._resetOrientation=function(){var t=this.options;return this.axes.setTo({yaw:t.yaw,pitch:t.pitch,fov:t.fov},0),this},t.lookAt=function(t,e){var i=t.yaw,n=t.pitch,r=t.fov,o=this.axes.get(),a=void 0===i?0:i-o.yaw,s=void 0===n?0:n-o.pitch,u=void 0===r?0:r-o.fov;this.axes.options.maximumDuration=1/0,this.axes.setBy({yaw:a,pitch:s,fov:u},e)},t.get=function(){return this.axes.get()},t.getYaw=function(){return this.axes.get().yaw},t.getPitch=function(){return this.axes.get().pitch},t.getFov=function(){return this.axes.get().fov},t.destroy=function(){this.axes&&this.axes.destroy(),this.axisPanInput&&this.axisPanInput.destroy(),this.axesWheelInput&&this.axesWheelInput.destroy(),this.axesTiltMotionInput&&this.axesTiltMotionInput.destroy(),this.axesDeviceOrientationInput&&this.axesDeviceOrientationInput.destroy(),this.axesPinchInput&&this.axesPinchInput.destroy(),this.axesMoveKeyInput&&this.axesMoveKeyInput.destroy(),this._deviceQuaternion&&this._deviceQuaternion.destroy()},u}(e);return t.VERSION=vt,t.CONTROL_MODE_VR=1,t.CONTROL_MODE_YAWPITCH=2,t.TOUCH_DIRECTION_ALL=6,t.TOUCH_DIRECTION_YAW=2,t.TOUCH_DIRECTION_PITCH=4,t.TOUCH_DIRECTION_NONE=1,t}(),Et="undefined"==typeof Promise?n.Promise:Promise,Rt={NONE:0,LOADING:1,LOADED:2,ERROR:3},Tt="readystatechange",It=function(){var t=function(i){function a(t){var e;return(e=i.call(this)||this)._image=null,e._onceHandlers=[],e._loadStatus=Rt.NONE,t&&e.set(t),e}d(a,i);var t=a.prototype;return t.get=function(){var n=this;return new Et(function(e,i){n._image?n._loadStatus===Rt.LOADED?e(n.getElement()):n._loadStatus===Rt.LOADING?a.isMaybeLoaded(n._image)?(n._loadStatus=Rt.LOADED,e(n.getElement())):n.on(Tt,function(t){t.type===Rt.LOADED?e(n.getElement()):i("ImageLoader: failed to load images.")}):i("ImageLoader: failed to load images"):i("ImageLoader: image is not defiend")})},t.set=function(t){var e=this;this._loadStatus=Rt.LOADING,this._image=a.createElement(t),a.isMaybeLoaded(this._image)?this._loadStatus=Rt.LOADED:this.onceLoaded(this._image,function(){e._loadStatus=Rt.LOADED,e.trigger(Tt,{type:Rt.LOADED})},function(){e._loadStatus=Rt.ERROR,e.trigger(Tt,{type:Rt.ERROR})})},a.createElement=function(t){return(t instanceof Array?t:[t]).map(function(t){var e=t;return"string"==typeof t&&((e=new Image).crossOrigin="anonymous",e.src=t),e})},t.getElement=function(){return 1===this._image.length?this._image[0]:this._image},a.isMaybeLoaded=function(t){var e=!1;return t instanceof Image?e=t.complete&&0!==t.naturalWidth:t instanceof Array&&(e=!t.some(function(t){return!t.complete||0===t.naturalWidth})),e},t.onceLoaded=function(t,e,i){var n=this,r=t instanceof Array?t:[t],o=r.filter(function(t){return!a.isMaybeLoaded(t)}).map(function(i){return new Et(function(t,e){n._once(i,"load",function(){return t(i)}),n._once(i,"error",function(){return e(i)})})});Et.all(o).then(function(t){return e(1===r.length?r[0]:r)},function(t){return i(t)})},t._once=function(i,n,r){var t=function t(e){i.removeEventListener(n,t),r(e)};i.addEventListener(n,t),this._onceHandlers.push({target:i,type:n,fn:t})},t.getStatus=function(){return this._loadStatus},t.destroy=function(){this._onceHandlers.forEach(function(t){t.target.removeEventListener(t.type,t.fn)}),this._onceHandlers=[],this._image.src="",this._image=null,this._loadStatus=Rt.NONE},a}(e);return t.STATUS=Rt,t}(),Ct="undefined"==typeof Promise?n.Promise:Promise,At=0,St=1,bt=2,Pt=3,Ot=4,Mt=-1,Dt={};Dt[St]="loadedmetadata",Dt[bt]="loadeddata",Dt[Pt]="canplay",Dt[Ot]="canplaythrough";var Vt,Lt,Nt=function(){function t(t){this._handlers=[],this._sourceCount=0,this._thresholdReadyState=St,this._thresholdEventName=Dt[this._thresholdReadyState],this._loadStatus=t&&t.readyState||At,this._onerror=this._onerror.bind(this),t&&this.set(t)}var e=t.prototype;return e._onerror=function(){this._errorCount++,this._errorCount>=this._sourceCount&&(this._loadStatus=Mt,this._detachErrorHandler(this._onerror))},e._appendSourceElement=function(t){var e,i;if("object"==typeof t?(e=t.src,i=t.type):"string"==typeof t&&(e=t),!e)return!1;var n=document.createElement("source");return n.src=e,i&&(n.type=i),this._video.appendChild(n),!0},e.set=function(t){var e=this;this._reset(),t&&(t instanceof HTMLVideoElement?this._video=t:"string"!=typeof t&&"object"!=typeof t||(this._video=document.createElement("video"),this._video.setAttribute("crossorigin","anonymous"),this._video.setAttribute("webkit-playsinline",""),this._video.setAttribute("playsinline",""),t instanceof Array?t.forEach(function(t){return e._appendSourceElement(t)}):this._appendSourceElement(t),this._sourceCount=this._video.querySelectorAll("source").length,0<this._sourceCount?this._video.readyState<this._thresholdReadyState&&(this._video.load(),this._attachErrorHandler(this._onerror)):this._video=null))},e._attachErrorHandler=function(e){this._video.addEventListener("error",e),this._sources=this._video.querySelectorAll("source"),[].forEach.call(this._sources,function(t){t.addEventListener("error",e)})},e._detachErrorHandler=function(e){this._video.removeEventListener("error",e),[].forEach.call(this._sources,function(t){t.removeEventListener("error",e)})},e.get=function(){var i=this;return new Ct(function(t,e){if(i._video)if(i._loadStatus===Mt)e("VideoLoader: video source is invalid");else if(i._video.readyState>=i._thresholdReadyState)t(i._video);else{i._attachErrorHandler(function t(){i._loadStatus===Mt&&(i._detachErrorHandler(t),e("VideoLoader: video source is invalid"))}),i._once(i._thresholdEventName,function(){return t(i._video)})}else e("VideoLoader: video is undefined")})},e.getElement=function(){return this._video},e.destroy=function(){this._reset()},e._reset=function(){var e=this;this._handlers.forEach(function(t){e._video.removeEventListener(t.type,t.fn)}),this._handlers=[],this._video=null,this._sourceCount=0,this._errorCount=0},e._once=function(i,n){var r=this._video,t=function t(e){r.removeEventListener(i,t),n(e)};r.addEventListener(i,t,!0),this._handlers.push({type:i,fn:t})},t}(),Ft={0:"NO_ERROR",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",37442:"CONTEXT_LOST_WEBGL"},Ut=null,Qt=function(){function n(){}return n.createShader=function(t,e,i){var n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(t.deleteShader(n),null)},n.createProgram=function(t,e,i){var n=t.createProgram();return t.attachShader(n,e),t.attachShader(n,i),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS)?n:(t.deleteProgram(n),null)},n.initBuffer=function(t,e,i,n,r){var o=t.createBuffer();return t.bindBuffer(e,o),t.bufferData(e,i,t.STATIC_DRAW),o&&(o.itemSize=n,o.numItems=i.length/n),void 0!==r&&(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,o.itemSize,t.FLOAT,!1,0,0)),o},n.getWebglContext=function(t,e){var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],n=null,r=c({preserveDrawingBuffer:!1,antialias:!1},e);function o(t){return t.statusMessage}t.addEventListener("webglcontextcreationerror",o);for(var a=0;a<i.length;a++){try{n=t.getContext(i[a],r)}catch(t){}if(n)break}return t.removeEventListener("webglcontextcreationerror",o),n},n.createTexture=function(t,e){var i=t.createTexture();return t.bindTexture(e,i),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(e,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(e,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(e,null),i},n.isWebGLAvailable=function(){if(null===Ut){var t=document.createElement("canvas"),e=n.getWebglContext(t);if(Ut=!!e,e){var i=e.getExtension("WEBGL_lose_context");i&&i.loseContext()}}return Ut},n.isStableWebGL=function(){var t=P(),e=!0;return"android"===t.os.name&&parseFloat(t.os.version)<=4.3?e=!1:"android"===t.os.name&&4.4===parseFloat(t.os.version)&&"chrome"!==t.browser.name&&(e=!1),e},n.getErrorNameFromWebGLErrorCode=function(t){return t in Ft?Ft[t]:"UNKNOWN_ERROR"},n.texImage2D=function(t,e,i){try{t.texImage2D(e,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i)}catch(t){console.error("WebGLUtils.texImage2D error:",t)}},n.getMaxTextureSize=function(t){return t.getParameter(t.MAX_TEXTURE_SIZE)},n}(),zt=P(),Gt="ie"===zt.browser.name&&"11.0"===zt.browser.version,Wt={ERROR:"error"},Xt=function(){var t=function(e){function t(){var t;return(t=e.call(this)||this)._forceDimension=null,t._pixelCanvas=null,t._pixelContext=null,t}d(t,e);var i=t.prototype;return i.getDimension=function(t){return{width:t.naturalWidth||t.videoWidth,height:t.naturalHeight||t.videoHeight}},i.updateShaderData=function(t){},i._initPixelSource=function(t,e){if(Gt&&t instanceof HTMLVideoElement||e){var i=e||this.getDimension(t),n=i.width,r=i.height;this._pixelCanvas=document.createElement("canvas"),this._pixelCanvas.width=n,this._pixelCanvas.height=r,this._pixelContext=this._pixelCanvas.getContext("2d")}this._forceDimension=e},i._getPixelSource=function(t){if(!this._pixelCanvas)return t;var e=this.getDimension(t),i=this._forceDimension||e;return this._pixelCanvas.width!==i.width&&(this._pixelCanvas.width=i.width),this._pixelCanvas.height!==i.height&&(this._pixelCanvas.height=i.height),this._forceDimension?this._pixelContext.drawImage(t,0,0,e.width,e.height,0,0,i.width,i.height):this._pixelContext.drawImage(t,0,0),this._pixelCanvas},i._extractTileConfig=function(t){var e=Array.isArray(t.tileConfig)?t.tileConfig:Array.apply(void 0,Array(6)).map(function(){return t.tileConfig});return e=e.map(function(t){return c({flipHorizontal:!1,rotation:0},t)})},i._triggerError=function(t){console.error("Renderer Error:",t),this.trigger(Wt.ERROR,{message:"string"==typeof t?t:t.message})},t}(e);return t.EVENTS=Wt,t}(),Yt=function(){var t=function(t){function l(){return t.apply(this,arguments)||this}d(l,t);var e=l.prototype;return e.getVertexPositionData=function(){return l._VERTEX_POSITION_DATA=null!==l._VERTEX_POSITION_DATA?l._VERTEX_POSITION_DATA:[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,1,-1,-1,-1,-1,-1,-1,-1,1,1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]},e.getIndexData=function(){if(l._INDEX_DATA)return l._INDEX_DATA;for(var t=[],e=this.getVertexPositionData(),i=0;i<e.length/3;i+=4)t.push(i,i+2,i+1,i,i+3,i+2);return l._INDEX_DATA=t},l.extractOrder=function(t){return t.order||"RLUDBF"},e.getTextureCoordData=function(t){var e=l.extractOrder(t),u=this.getVertexPositionData(),i=this._extractTileConfig(t);return"BFUDRL".split("").map(function(t){return i[e.indexOf(t)]}).map(function(t,e){for(var i=parseInt(t.rotation/90,10),n=t.flipHorizontal?[0,1,2,3]:[1,0,3,2],r=0;r<Math.abs(i);r++)t.flipHorizontal&&0<i||!t.flipHorizontal&&i<0?n.push(n.shift()):n.unshift(n.pop());for(var o=u.slice(12*e,12*e+12),a=[],s=0;s<4;s++)a[n[s]]=o.splice(0,3);return a}).join().split(",").map(function(t){return parseInt(t,10)})},e.getVertexShaderSource=function(){return"\n\t\t\tattribute vec3 aVertexPosition;\n\t\t\tattribute vec3 aTextureCoord;\n\t\t\tuniform mat4 uMVMatrix;\n\t\t\tuniform mat4 uPMatrix;\n\t\t\tvarying highp vec3 vVertexDirectionVector;\n\t\t\tvoid main(void) {\n\t\t\t\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n\t\t\t\tvVertexDirectionVector = aTextureCoord;\n\t\t\t}"},e.getFragmentShaderSource=function(){return"\n\t\t\tvarying highp vec3 vVertexDirectionVector;\n\t\t\tuniform samplerCube uSampler;\n\t\t\tvoid main(void) {\n\t\t\t\tgl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n\t\t\t}"},e.updateTexture=function(t,e,i){var n=l.extractOrder(i),r={};n.split("").forEach(function(t,e){r[t]=e});try{if(e instanceof Array)for(var o=0;o<6;o++){var a=r["RLUDBF"[o]];Qt.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+o,e[a])}else for(var s=this.getMaxCubeMapTextureSize(t,e),u=0;u<6;u++){var h=r["RLUDBF"[u]],c=this.extractTileFromImage(e,h,s);Qt.texImage2D(t,t.TEXTURE_CUBE_MAP_POSITIVE_X+u,c)}}catch(t){this._triggerError(t)}},e.bindTexture=function(t,e,i,n){t.bindTexture(t.TEXTURE_CUBE_MAP,e),this.updateTexture(t,i,n)},e.getSourceTileSize=function(t){var e=this.getDimension(t),i=e.width,n=e.height,r=i/n;return r===1/6?i:6===r?n:r===2/3?i/2:i/3},e.extractTileFromImage=function(t,e,i){var n=this.getDimension(t).width,r=this.getSourceTileSize(t),o=document.createElement("canvas");o.width=i,o.height=i;var a=o.getContext("2d"),s=n/r,u=r*e%(r*s),h=parseInt(e/s,10)*r;return a.drawImage(t,u,h,r,r,0,0,i,i),o},e.getMaxCubeMapTextureSize=function(t,e){var i=P(),n=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),r=this.getSourceTileSize(e);if("ie"===i.browser.name&&11===parseInt(i.browser.version,10)&&!Z.isPowerOfTwo(r))for(var o=1;o<n;o*=2)if(!(o<r)){r=o;break}return"ios"===i.os.name&&9===parseInt(i.os.version,10)&&(r=1024),"ios"===i.os.name&&8===parseInt(i.os.version,10)&&(r=512),Math.min(n,r)},l}(Xt);return t._VERTEX_POSITION_DATA=null,t._INDEX_DATA=null,t}(),Bt=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var i=e.prototype;return i.getVertexShaderSource=function(){return"\n\t\t\tattribute vec3 aVertexPosition;\n\t\t\tattribute vec2 aTextureCoord;\n\t\t\tuniform mat4 uMVMatrix;\n\t\t\tuniform mat4 uPMatrix;\n\t\t\tvarying highp vec2 vTextureCoord;\n\t\t\tvoid main(void) {\n\t\t\t\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n\t\t\t\tvTextureCoord = aTextureCoord;\n\t\t\t}"},i.getFragmentShaderSource=function(){return"\n\t\t\t#define PI 3.14159265359\n\n\t\t\tprecision mediump float;\n\t\t\tvarying highp vec2 vTextureCoord;\n\t\t\tuniform sampler2D uSampler;\n\t\t\tuniform bool uIsEAC;\n\n\t\t\tconst vec2 OPERATE_COORDS_RANGE = vec2(-1.0, 1.0);\n\t\t\tconst vec2 TEXTURE_COORDS_RANGE = vec2(0.0, 1.0);\n\t\t\t// vector type is used for initializing values instead of array.\n\t\t\tconst vec4 TEXTURE_DIVISION_X = vec4(0.0, 1.0 / 3.0, 2.0 / 3.0, 1.0);\n\t\t\tconst vec3 TEXTURE_DIVISION_Y = vec3(0.0, 1.0 / 2.0, 1.0);\n\t\t\tconst float EAC_CONST = 2.0 / PI;\n\n\t\t\tfloat scale(vec2 domainRange, vec2 targetRange, float val) {\n\t\t\t\tfloat unit = 1.0 / (domainRange[1] - domainRange[0]);\n\t\t\t\treturn targetRange[0] + (targetRange[1] - targetRange[0]) * (val - domainRange[0]) * unit;\n\t\t\t}\n\n\t\t\tvoid main(void) {\n\t\t\t\tfloat transformedCoordX;\n\t\t\t\tfloat transformedCoordY;\n\n\t\t\t\tif (uIsEAC) {\n\t\t\t\t\tvec2 orgTextureRangeX;\n\t\t\t\t\tvec2 orgTextureRangeY;\n\n\t\t\t\t\t// Apply EAC transform\n\t\t\t\t\tif (vTextureCoord.s >= TEXTURE_DIVISION_X[2]) {\n\t\t\t\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[2], TEXTURE_DIVISION_X[3]);\n\t\t\t\t\t} else if (vTextureCoord.s >= TEXTURE_DIVISION_X[1]) {\n\t\t\t\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[1], TEXTURE_DIVISION_X[2]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\torgTextureRangeX = vec2(TEXTURE_DIVISION_X[0], TEXTURE_DIVISION_X[1]);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (vTextureCoord.t >= TEXTURE_DIVISION_Y[1]) {\n\t\t\t\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[1], TEXTURE_DIVISION_Y[2]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\torgTextureRangeY = vec2(TEXTURE_DIVISION_Y[0], TEXTURE_DIVISION_Y[1]);\n\t\t\t\t\t}\n\n\t\t\t\t\t// scaling coors by the coordinates following the range from -1.0 to 1.0.\n\t\t\t\t\tfloat px = scale(orgTextureRangeX, OPERATE_COORDS_RANGE, vTextureCoord.s);\n\t\t\t\t\tfloat py = scale(orgTextureRangeY, OPERATE_COORDS_RANGE, vTextureCoord.t);\n\n\t\t\t\t\tfloat qu = EAC_CONST * atan(px) + 0.5;\n\t\t\t\t\tfloat qv = EAC_CONST * atan(py) + 0.5;\n\n\t\t\t\t\t// re-scaling coors by original coordinates ranges\n\t\t\t\t\ttransformedCoordX = scale(TEXTURE_COORDS_RANGE, orgTextureRangeX, qu);\n\t\t\t\t\ttransformedCoordY = scale(TEXTURE_COORDS_RANGE, orgTextureRangeY, qv);\n\t\t\t\t} else {\n\t\t\t\t\t// normal cubemap\n\t\t\t\t\ttransformedCoordX = vTextureCoord.s;\n\t\t\t\t\ttransformedCoordY = vTextureCoord.t;\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = texture2D(uSampler, vec2(transformedCoordX, transformedCoordY));\n\t\t\t}"},i.getVertexPositionData=function(){return this._vertices||(this._vertices=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,1,-1,1,1,-1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1]),this._vertices},i.getIndexData=function(){var i=this;return function(){for(var t=[],e=0;e<i._vertices.length/3;e+=4)t.push(e,e+1,e+2,e,e+2,e+3);return t}()},i.getTextureCoordData=function(t){for(var i=this,e=t.order||"RLUDFB",n=[],r=1;0<=r;r--)for(var o=0;o<3;o++){var a=[o/3,r/2,(o+1)/3,r/2,(o+1)/3,(r+1)/2,o/3,(r+1)/2];n.push(a)}var s=this._extractTileConfig(t);return n=n.map(function(t){return i._shrinkCoord(t)}).map(function(t,e){return i._transformCoord(t,s[e])}),"BFUDRL".split("").map(function(t){return e.indexOf(t)}).map(function(t){return n[t]}).reduce(function(t,e){return t.concat(e)},[])},i.updateTexture=function(t,e){Qt.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},i.bindTexture=function(t,e,i){var n=this.getDimension(i),r=n.width,o=n.height,a=Math.max(r,o),s=Qt.getMaxTextureSize(t);s<a?this._triggerError("Image width("+r+") exceeds device limit("+s+"))"):(this._initPixelSource(i),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,i))},i._transformCoord=function(t,e){var i=t.slice();return e.flipHorizontal&&(i=this._flipHorizontalCoord(i)),e.rotation&&(i=this._rotateCoord(i,e.rotation)),i},i._shrinkCoord=function(t){return[t[0]+0,t[1]+0,t[2]-0,t[3]+0,t[4]-0,t[5]-0,t[6]+0,t[7]-0]},i._rotateCoord=function(t,e){var i,n=parseInt(e/90,10)%4;if(0===n)return t;return 0<n?(i=t.splice(0,2*n),t.concat(i)):(i=t.splice(2*(4+n),2*-n)).concat(t)},i._flipHorizontalCoord=function(t){return[t[2],t[3],t[0],t[1],t[6],t[7],t[4],t[5]]},e}(Xt),kt=-.5*Math.PI,Ht=[],jt=[],qt=[];for(Vt=0;Vt<=60;Vt++){var Kt=(Vt/60-.5)*Math.PI,Zt=Math.sin(Kt),Jt=Math.cos(Kt);for(Lt=0;Lt<=60;Lt++){var $t=2*(Lt/60-.5)*Math.PI+kt,te=Math.sin($t),ee=Math.cos($t)*Jt,ie=Zt,ne=te*Jt,re=Lt/60,oe=Vt/60;if(Ht.push(re,oe),jt.push(2*ee,2*ie,2*ne),60!==Lt&&60!==Vt){var ae=61*Vt+Lt,se=ae+60+1;qt.push(ae,se,ae+1,se,se+1,ae+1)}}}var ue=function(){var t=function(i){function t(t){var e;return(e=i.call(this)||this)._isStereoscopic=t&&t.isStereoscopic||!1,e}d(t,i);var e=t.prototype;return e.getVertexPositionData=function(){return t._VERTEX_POSITION_DATA},e.getIndexData=function(){return t._INDEX_DATA},e.getTextureCoordData=function(){return this._isStereoscopic?t._TEXTURE_COORD_DATA.map(function(t,e){return e%2==1?t/2:t}):t._TEXTURE_COORD_DATA},e.getVertexShaderSource=function(){return"\n\t\t\tattribute vec3 aVertexPosition;\n\t\t\tattribute vec2 aTextureCoord;\n\t\t\tuniform mat4 uMVMatrix;\n\t\t\tuniform mat4 uPMatrix;\n\t\t\tvarying highp vec2 vTextureCoord;\n\t\t\tvoid main(void) {\n\t\t\t\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n\t\t\t\tvTextureCoord = aTextureCoord;\n\t\t\t}"},e.getFragmentShaderSource=function(){return"\n\t\t\tvarying highp vec2 vTextureCoord;\n\t\t\tuniform sampler2D uSampler;\n\t\t\tvoid main(void) {\n\t\t\t\tgl_FragColor = texture2D(\n\t\t\t\t\tuSampler,\n\t\t\t\t\tvec2(vTextureCoord.s, vTextureCoord.t)\n\t\t\t\t);\n\t\t\t}"},e.updateTexture=function(t,e){Qt.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},e.bindTexture=function(t,e,i){var n=this.getDimension(i),r=n.width,o=n.height,a=Math.max(r,o),s=Qt.getMaxTextureSize(t);s<a?this._triggerError("Image width("+r+") exceeds device limit("+s+"))"):(this._initPixelSource(i),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,i))},t}(Xt);return t._VERTEX_POSITION_DATA=jt,t._TEXTURE_COORD_DATA=Ht,t._INDEX_DATA=qt,t}(),he=[],ce=[],le=[],de=function(){var t=function(t){function e(){return t.apply(this,arguments)||this}d(e,t);var i=e.prototype;return i.getVertexPositionData=function(){return e._VERTEX_POSITION_DATA},i.getIndexData=function(){return e._INDEX_DATA},i.getTextureCoordData=function(){return e._TEXTURE_COORD_DATA},i.getVertexShaderSource=function(){return"\n\t\t\tattribute vec3 aVertexPosition;\n\t\t\tattribute vec2 aTextureCoord;\n\t\t\tuniform mat4 uMVMatrix;\n\t\t\tuniform mat4 uPMatrix;\n\t\t\tvarying highp vec2 vTextureCoord;\n\t\t\tvoid main(void) {\n\t\t\t\tgl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);\n\t\t\t\tvTextureCoord = aTextureCoord;\n\t\t\t}"},i.getFragmentShaderSource=function(){return"\n\t\t\tvarying highp vec2 vTextureCoord;\n\t\t\tuniform sampler2D uSampler;\n\t\t\tvoid main(void) {\n\t\t\t\tgl_FragColor = texture2D(\n\t\t\t\t\tuSampler,\n\t\t\t\t\tvec2(vTextureCoord.s, vTextureCoord.t)\n\t\t\t\t);\n\t\t\t}"},i.updateTexture=function(t,e){Qt.texImage2D(t,t.TEXTURE_2D,this._getPixelSource(e))},i.bindTexture=function(t,e,i){var n,r=this.getDimension(i),o=r.width,a=r.height,s=Math.max(o,a),u=Qt.getMaxTextureSize(t);u<s&&(this._triggerError("Image width("+o+") exceeds device texture limit("+u+"))"),n=a<o?{width:u,height:u*a/o}:{width:u*o/a,height:u}),this._initPixelSource(i,n),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.bindTexture(t.TEXTURE_2D,e),this.updateTexture(t,i)},i.updateShaderData=function(t){var e,i,n,r,o,a=t.imageAspectRatio,s=void 0===a?6:a;if(6<=(o=s<1?(r=!0,1/s):(r=!1,s))){var u=360/o;i=2*Math.PI,n=Math.tan(B.toRadian(u/2))}else i=o,n=.5;he.length=0,ce.length=0,le.length=0;for(var h=[-n,n],c=Math.PI/2+(2*Math.PI-i)/2,l=0,d=h.length;l<d;l++)for(e=0;e<=60;e++){var f=c+e/60*i,_=Math.cos(f),g=h[l],p=Math.sin(f),v=void 0,m=void 0;if(m=r?(v=1-l,e/60):(v=e/60,l),he.push(v,m),ce.push(_,g,p),0===l&&e<60){var y=e,w=y+60+1;le.push(y,w,y+1,w,w+1,y+1)}}},e}(Xt);return t._VERTEX_POSITION_DATA=ce,t._TEXTURE_COORD_DATA=he,t._INDEX_DATA=le,t}(),fe={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,FAIL_BIND_TEXTURE:13,INVALID_RESOURCE:14,RENDERING_CONTEXT_LOST:15},_e={READY:"ready",VIEW_CHANGE:"viewChange",ANIMATION_END:"animationEnd",ERROR:"error"},ge={EQUIRECTANGULAR:"equirectangular",CUBEMAP:"cubemap",CUBESTRIP:"cubestrip",PANORAMA:"panorama",STEREOSCOPIC_EQUI:"stereoequi"},pe="undefined"==typeof Promise?n.Promise:Promise,ve=ge,me=_||1;2<me&&(me=2);var ye={BIND_TEXTURE:"bindTexture",IMAGE_LOADED:"imageLoaded",ERROR:"error",RENDERING_CONTEXT_LOST:"renderingContextLost",RENDERING_CONTEXT_RESTORE:"renderingContextRestore"},we={INVALID_DEVICE:10,NO_WEBGL:11,FAIL_IMAGE_LOAD:12,RENDERER_ERROR:13},xe=function(){var t=function(s){function t(t,e,i,n,r,o){var a;return(a=s.call(this)||this).sphericalConfig=r,a.fieldOfView=r.fieldOfView,a.width=e,a.height=i,a._lastQuaternion=null,a._lastYaw=null,a._lastPitch=null,a._lastFieldOfView=null,a.pMatrix=K.create(),a.mvMatrix=K.create(),K.perspective(a.pMatrix,B.toRadian(a.fieldOfView),e/i,.1,100),a.textureCoordBuffer=null,a.vertexBuffer=null,a.indexBuffer=null,a.canvas=a._initCanvas(e,i),a._renderingContextAttributes=o,a._image=null,a._imageConfig=null,a._imageIsReady=!1,a._shouldForceDraw=!1,a._keepUpdate=!1,a._onContentLoad=a._onContentLoad.bind(u(u(a))),a._onContentError=a._onContentError.bind(u(u(a))),t&&a.setImage({image:t,imageType:r.imageType,isVideo:n,cubemapConfig:r.cubemapConfig}),a}d(t,s);var e=t.prototype;return e.getContent=function(){return this._image},e.setImage=function(t){var e=t.image,i=t.imageType,n=t.isVideo,r=void 0!==n&&n,o=t.cubemapConfig;return this._imageIsReady=!1,this._isVideo=r,this._imageConfig=c({order:i===ve.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHirozontal:!1,rotation:0}},o),this._setImageType(i),this._contentLoader&&this._contentLoader.destroy(),this._keepUpdate=r?(this._contentLoader=new Nt,!0):(this._contentLoader=new It,!1),this._contentLoader.set(e),this._image=this._contentLoader.getElement(),this._contentLoader.get().then(this._onContentLoad,this._onContentError).catch(function(t){return setTimeout(function(){throw t})})},e._setImageType=function(t){var e=this;if(t&&this._imageType!==t){switch(this._imageType=t,this._isCubeMap=t===ve.CUBEMAP,this._renderer&&this._renderer.off(),t){case ve.CUBEMAP:this._renderer=new Yt;break;case ve.CUBESTRIP:this._renderer=new Bt;break;case ve.PANORAMA:this._renderer=new de;break;case ve.STEREOSCOPIC_EQUI:this._renderer=new ue({isStereoscopic:!0});break;default:this._renderer=new ue}this._renderer.on(Xt.EVENTS.ERROR,function(t){e.trigger(ye.ERROR,{type:we.RENDERER_ERROR,message:t.message})}),this._initWebGL()}},e._initCanvas=function(t,e){var i=document.createElement("canvas");return i.width=t,i.height=e,i.style.bottom=0,i.style.left=0,i.style.right=0,i.style.top=0,i.style.margin="auto",i.style.maxHeight="100%",i.style.maxWidth="100%",i.style.outline="none",i.style.position="absolute",this._onWebglcontextlost=this._onWebglcontextlost.bind(this),this._onWebglcontextrestored=this._onWebglcontextrestored.bind(this),i.addEventListener("webglcontextlost",this._onWebglcontextlost),i.addEventListener("webglcontextrestored",this._onWebglcontextrestored),i},e._onContentError=function(t){return this._imageIsReady=!1,this._image=null,this.trigger(ye.ERROR,{type:we.FAIL_IMAGE_LOAD,message:"failed to load image"}),!1},e._triggerContentLoad=function(){this.trigger(ye.IMAGE_LOADED,{content:this._image,isVideo:this._isVideo,projectionType:this._imageType})},e._onContentLoad=function(t){return this._imageIsReady=!0,this._triggerContentLoad(),!0},e.isImageLoaded=function(){return!!this._image&&this._imageIsReady&&(!this._isVideo||2<=this._image.readyState)},e.bindTexture=function(){var i=this;return new pe(function(t,e){i._contentLoader?i._contentLoader.get().then(function(){return i._bindTexture()},e).then(t):e("ImageLoader is not initialized")})},e.attachTo=function(t){this.detach(),t.appendChild(this.canvas)},e.forceContextLoss=function(){if(this.hasRenderingContext()){var t=this.context.getExtension("WEBGL_lose_context");t&&t.loseContext()}},e.detach=function(){this.canvas.parentElement&&this.canvas.parentElement.removeChild(this.canvas)},e.destroy=function(){this._contentLoader&&this._contentLoader.destroy(),this.detach(),this.forceContextLoss(),this.off(),this.canvas.removeEventListener("webglcontextlost",this._onWebglcontextlost),this.canvas.removeEventListener("webglcontextrestored",this._onWebglcontextrestored)},e.hasRenderingContext=function(){return!(!this.context||this.context.isContextLost())&&!(this.context&&!this.context.getProgramParameter(this.shaderProgram,this.context.LINK_STATUS))},e._onWebglcontextlost=function(t){t.preventDefault(),this.trigger(ye.RENDERING_CONTEXT_LOST)},e._onWebglcontextrestored=function(t){this._initWebGL(),this.trigger(ye.RENDERING_CONTEXT_RESTORE)},e.updateFieldOfView=function(t){this.fieldOfView=t,this._updateViewport()},e.updateViewportDimensions=function(t,e){var i=!1;this.width=t,this.height=e;var n=t*me,r=e*me;n!==this.canvas.width&&(this.canvas.width=n,i=!0),r!==this.canvas.height&&(this.canvas.height=r,i=!0),i&&(this._updateViewport(),this._shouldForceDraw=!0)},e._updateViewport=function(){K.perspective(this.pMatrix,B.toRadian(this.fieldOfView),this.canvas.width/this.canvas.height,.1,100),this.context.viewport(0,0,this.context.drawingBufferWidth,this.context.drawingBufferHeight)},e._initWebGL=function(){var t;try{if(this._initRenderingContext(),t=this.context,this.updateViewportDimensions(this.width,this.height),this.shaderProgram&&t.deleteProgram(this.shaderProgram),this.shaderProgram=this._initShaderProgram(t),!this.shaderProgram)throw new Error("Failed to intialize shaders: "+Qt.getErrorNameFromWebGLErrorCode(t.getError()))}catch(t){return this.trigger(ye.ERROR,{type:we.NO_WEBGL,message:"no webgl support"}),this.destroy(),void console.error(t)}t.clearColor(0,0,0,0);var e=this._isCubeMap?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;this.texture&&t.deleteTexture(this.texture),this.texture=Qt.createTexture(t,e),this._imageType===ve.CUBESTRIP&&t.enable(t.CULL_FACE)},e._initRenderingContext=function(){if(!this.hasRenderingContext()){if(!window.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");if(this.context=Qt.getWebglContext(this.canvas,this._renderingContextAttributes),!this.context)throw new Error("Failed to acquire 3D rendering context")}},e._initShaderProgram=function(t){var e=this._renderer.getVertexShaderSource(),i=Qt.createShader(t,t.VERTEX_SHADER,e);if(!i)return!1;var n=this._renderer.getFragmentShaderSource(),r=Qt.createShader(t,t.FRAGMENT_SHADER,n);if(!r)return!1;var o=Qt.createProgram(t,i,r);return o?(t.useProgram(o),o.vertexPositionAttribute=t.getAttribLocation(o,"aVertexPosition"),t.enableVertexAttribArray(o.vertexPositionAttribute),o.pMatrixUniform=t.getUniformLocation(o,"uPMatrix"),o.mvMatrixUniform=t.getUniformLocation(o,"uMVMatrix"),o.samplerUniform=t.getUniformLocation(o,"uSampler"),o.textureCoordAttribute=t.getAttribLocation(o,"aTextureCoord"),t.enableVertexAttribArray(o.textureCoordAttribute),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT),t.uniform1i(o.samplerUniform,0),o):null},e._initBuffers=function(){var t=this._renderer.getVertexPositionData(),e=this._renderer.getIndexData(),i=this._renderer.getTextureCoordData(this._imageConfig),n=this.context;this.vertexBuffer=Qt.initBuffer(n,n.ARRAY_BUFFER,new Float32Array(t),3,this.shaderProgram.vertexPositionAttribute),this.indexBuffer=Qt.initBuffer(n,n.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),1),this.textureCoordBuffer=Qt.initBuffer(n,n.ARRAY_BUFFER,new Float32Array(i),this._isCubeMap?3:2,this.shaderProgram.textureCoordAttribute)},e._bindTexture=function(){if(this._imageType===ve.CUBESTRIP){var t=this._renderer.getDimension(this._image),e=t.width,i=t.height,n=e&&i&&e/i!=1.5;this.context.uniform1f(this.context.getUniformLocation(this.shaderProgram,"uIsEAC"),n)}else if(this._imageType===ve.PANORAMA){var r=this._renderer.getDimension(this._image),o=r.width,a=r.height,s=o&&a&&o/a;this._renderer.updateShaderData({imageAspectRatio:s})}this._initBuffers(),this._renderer.bindTexture(this.context,this.texture,this._image,this._imageConfig),this._shouldForceDraw=!0,this.trigger(ye.BIND_TEXTURE)},e._updateTexture=function(){this._renderer.updateTexture(this.context,this._image,this._imageConfig)},e.keepUpdate=function(t){t&&!1===this.isImageLoaded()&&(this._shouldForceDraw=!0),this._keepUpdate=t},e.renderWithQuaternion=function(t,e){this.isImageLoaded()&&(!1===this._keepUpdate&&this._lastQuaternion&&q.exactEquals(this._lastQuaternion,t)&&this.fieldOfView&&this.fieldOfView===e&&!1===this._shouldForceDraw||(void 0!==e&&e!==this.fieldOfView&&this.updateFieldOfView(e),this.mvMatrix=K.fromQuat(K.create(),t),this._draw(),this._lastQuaternion=q.clone(t),this._shouldForceDraw&&(this._shouldForceDraw=!1)))},e.render=function(t,e,i){this.isImageLoaded()&&(!1===this._keepUpdate&&null!==this._lastYaw&&this._lastYaw===t&&null!==this._lastPitch&&this._lastPitch===e&&this.fieldOfView&&this.fieldOfView===i&&!1===this._shouldForceDraw||(void 0!==i&&i!==this.fieldOfView&&this.updateFieldOfView(i),K.identity(this.mvMatrix),K.rotateX(this.mvMatrix,this.mvMatrix,-B.toRadian(e)),K.rotateY(this.mvMatrix,this.mvMatrix,-B.toRadian(t)),this._draw(),this._lastYaw=t,this._lastPitch=e,this._shouldForceDraw&&(this._shouldForceDraw=!1)))},e._draw=function(){var t=this.context;t.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,this.pMatrix),t.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,this.mvMatrix),this._isVideo&&this._keepUpdate&&this._updateTexture(),this.indexBuffer&&t.drawElements(t.TRIANGLES,this.indexBuffer.numItems,t.UNSIGNED_SHORT,0)},e.getProjectionRenderer=function(){return this._renderer},t}(e);return t.EVENTS=ye,t.ERROR_TYPE=we,t}(),Ee="undefined"==typeof Promise?n.Promise:Promise,Re=function(){var t=function(a){function s(t,e){var i;if(void 0===e&&(e={}),i=a.call(this)||this,!Qt.isWebGLAvailable())return setTimeout(function(){i.trigger(_e.ERROR,{type:fe.NO_WEBGL,message:"no webgl support"})},0),u(u(i))||u(i);if(!Qt.isStableWebGL())return setTimeout(function(){i.trigger(_e.ERROR,{type:fe.INVALID_DEVICE,message:"blacklisted browser"})},0),u(u(i))||u(i);if(e.image&&e.video)return setTimeout(function(){i.trigger(_e.ERROR,{type:fe.INVALID_RESOURCE,message:"Specifying multi resouces(both image and video) is not valid."})},0),u(u(i))||u(i);i._container=t,i._image=e.image||e.video,i._isVideo=!!e.video,i._projectionType=e.projectionType||ge.EQUIRECTANGULAR,i._cubemapConfig=c({order:i._projectionType===ge.CUBEMAP?"RLUDBF":"RLUDFB",tileConfig:{flipHirozontal:!1,rotation:0}},e.cubemapConfig),i._width=e.width||parseInt(window.getComputedStyle(t).width,10),i._height=e.height||parseInt(window.getComputedStyle(t).height,10),i._yaw=e.yaw||0,i._pitch=e.pitch||0,i._fov=e.fov||65,i._gyroMode=e.gyroMode||pt.YAWPITCH,i._quaternion=null,i._aspectRatio=0!==i._height?i._width/i._height:1;var n=e.fovRange||[30,110],r=s._isValidTouchDirection(e.touchDirection)?e.touchDirection:xt.TOUCH_DIRECTION_ALL,o=c(e,{element:t,yaw:i._yaw,pitch:i._pitch,fov:i._fov,gyroMode:i._gyroMode,fovRange:n,aspectRatio:i._aspectRatio,touchDirection:r});return i._isReady=!1,i._initYawPitchControl(o),i._initRenderer(i._yaw,i._pitch,i._fov,i._projectionType,i._cubemapConfig),i}d(s,a);var t=s.prototype;return t.getVideo=function(){return this._isVideo?this._photoSphereRenderer.getContent():null},t.setVideo=function(t,e){return void 0===e&&(e={}),t&&this.setImage(t,{projectionType:e.projectionType,isVideo:!0,cubemapConfig:e.cubemapConfig}),this},t.getImage=function(){return this._isVideo?null:this._photoSphereRenderer.getContent()},t.setImage=function(t,e){void 0===e&&(e={});var i=c({order:"RLUDBF",tileConfig:{flipHirozontal:!1,rotation:0}},e.cubemapConfig),n=!!e.isVideo;return this._image&&this._isVideo!==n?console.warn("Currently not supporting to change content type(Image <--\x3e Video)"):t&&(this._image=t,this._isVideo=n,this._projectionType=e.projectionType||ge.EQUIRECTANGULAR,this._cubemapConfig=i,this._deactivate(),this._initRenderer(this._yaw,this._pitch,this._fov,this._projectionType,this._cubemapConfig)),this},t.keepUpdate=function(t){return this._photoSphereRenderer.keepUpdate(t),this},t.getProjectionType=function(){return this._projectionType},t._initRenderer=function(t,e,i,n,r){var o=this;this._photoSphereRenderer=new xe(this._image,this._width,this._height,this._isVideo,{initialYaw:t,initialPitch:e,fieldOfView:i,imageType:n,cubemapConfig:r}),this._bindRendererHandler(),this._photoSphereRenderer.bindTexture().then(function(){return o._activate()}).catch(function(){o._triggerEvent(_e.ERROR,{type:fe.FAIL_BIND_TEXTURE,message:"failed to bind texture"})})},t._updateYawPitchIfNeeded=function(){if(this._projectionType===s.ProjectionType.PANORAMA){var t,e,i,n=this._photoSphereRenderer.getContent(),r=n.naturalWidth/n.naturalHeight;r<1&&(r=1/r),i=r<6?(e=B.toDegree(r),t=!1,2*B.toDegree(Math.atan(.5))):(t=!0,(e=360)/r);var o=this._yawPitchControl.option("fovRange")[0];this._yawPitchControl.option({fov:i,yawRange:[-e/2,e/2],isCircular:t,pitchRange:[-i/2,i/2],fovRange:[o,i]}),this.lookAt({fov:i})}},t._bindRendererHandler=function(){var e=this;this._photoSphereRenderer.on(xe.EVENTS.ERROR,function(t){e.trigger(_e.ERROR,t)}),this._photoSphereRenderer.on(xe.EVENTS.RENDERING_CONTEXT_LOST,function(t){e._deactivate(),e.trigger(_e.ERROR,{type:fe.RENDERING_CONTEXT_LOST,message:"webgl rendering context lost"})})},t._initYawPitchControl=function(t){var e=this;this._yawPitchControl=new xt(t),this._yawPitchControl.on(_e.ANIMATION_END,function(t){e._triggerEvent(_e.ANIMATION_END,t)}),this._yawPitchControl.on("change",function(t){e._yaw=t.yaw,e._pitch=t.pitch,e._fov=t.fov,e._quaternion=t.quaternion,e._triggerEvent(_e.VIEW_CHANGE,t)})},t._triggerEvent=function(t,e){var i=e||{};return this.trigger(t,i)},t.setUseZoom=function(t){return"boolean"==typeof t&&this._yawPitchControl.option("useZoom",t),this},t.setUseKeyboard=function(t){return this._yawPitchControl.option("useKeyboard",t),this},t.setGyroMode=function(t){return this._yawPitchControl.option("gyroMode",t),this},t.setFovRange=function(t){return this._yawPitchControl.option("fovRange",t),this},t.getFovRange=function(){return this._yawPitchControl.option("fovRange")},t.updateViewportDimensions=function(t){if(void 0===t&&(t={width:void 0,height:void 0}),!this._isReady)return this;var e;void 0!==t.width&&void 0!==t.height||(e=window.getComputedStyle(this._container));var i=t.width||parseInt(e.width,10),n=t.height||parseInt(e.height,10);return i===this._width&&n===this._height||(this._width=i,this._height=n,this._aspectRatio=i/n,this._photoSphereRenderer.updateViewportDimensions(i,n),this._yawPitchControl.option("aspectRatio",this._aspectRatio),this._yawPitchControl.updatePanScale({height:n}),this.lookAt({},0)),this},t.getFov=function(){return this._fov},t._getHFov=function(){return B.toDegree(2*Math.atan(this._aspectRatio*Math.tan(B.toRadian(this._fov)/2)))},t.getYaw=function(){return this._yaw},t.getPitch=function(){return this._pitch},t.getYawRange=function(){return this._yawPitchControl.option("yawRange")},t.getPitchRange=function(){return this._yawPitchControl.option("pitchRange")},t.setYawRange=function(t){return this._yawPitchControl.option("yawRange",t),this},t.setPitchRange=function(t){return this._yawPitchControl.option("pitchRange",t),this},t.setShowPolePoint=function(t){return this._yawPitchControl.option("showPolePoint",t),this},t.lookAt=function(t,e){if(!this._isReady)return this;var i=void 0!==t.yaw?t.yaw:this._yaw,n=void 0!==t.pitch?t.pitch:this._pitch,r=this._yawPitchControl.option("pitchRange"),o=r[1]-r[0],a=void 0!==t.fov?t.fov:this._fov;return o<a&&(a=o),this._yawPitchControl.lookAt({yaw:i,pitch:n,fov:a},e),0===e&&this._photoSphereRenderer.render(i,n,a),this},t._activate=function(){this._photoSphereRenderer.attachTo(this._container),this._yawPitchControl.enable(),this.updateViewportDimensions(),this._isReady=!0,this._updateYawPitchIfNeeded(),this._triggerEvent(_e.READY),this._startRender()},t._startRender=function(){this._renderLoop=this._renderLoop.bind(this),this._rafId=window.requestAnimationFrame(this._renderLoop)},t._renderLoop=function(){this._photoSphereRenderer&&(this._quaternion?this._photoSphereRenderer.renderWithQuaternion(this._quaternion,this._fov):this._photoSphereRenderer.render(this._yaw,this._pitch,this._fov)),this._rafId=window.requestAnimationFrame(this._renderLoop)},t._stopRender=function(){this._rafId&&(window.cancelAnimationFrame(this._rafId),delete this._rafId)},t._deactivate=function(){this._photoSphereRenderer&&(this._photoSphereRenderer.destroy(),this._photoSphereRenderer=null),this._isReady&&(this._yawPitchControl.disable(),this._stopRender(),this._isReady=!1)},s._isValidTouchDirection=function(t){return t===s.TOUCH_DIRECTION.NONE||t===s.TOUCH_DIRECTION.YAW||t===s.TOUCH_DIRECTION.PITCH||t===s.TOUCH_DIRECTION.ALL},t.setTouchDirection=function(t){return s._isValidTouchDirection(t)&&this._yawPitchControl.option("touchDirection",t),this},t.getTouchDirection=function(){return this._yawPitchControl.option("touchDirection")},t.destroy=function(){return this._deactivate(),this._yawPitchControl&&(this._yawPitchControl.destroy(),this._yawPitchControl=null),this},s.isSupported=function(){return Qt.isWebGLAvailable()&&Qt.isStableWebGL()},s.isWebGLAvailable=function(){return Qt.isWebGLAvailable()},s.isGyroSensorAvailable=function(t){var n;f?Ee.race([new Ee(function(i,t){n=function(t){var e=!(null==t.rotationRate.alpha);i(e)},window.addEventListener("devicemotion",n)}),new Ee(function(t,e){setTimeout(function(){return t(!1)},1e3)})]).then(function(e){window.removeEventListener("devicemotion",n),t&&t(e),s.isGyroSensorAvailable=function(t){return t&&t(e),e}}):t&&t(!1)},s}(e);return t.VERSION=vt,t.ERROR_TYPE=fe,t.EVENTS=_e,t.PROJECTION_TYPE=ge,t.GYRO_MODE=pt,t.ProjectionType=ge,t.TOUCH_DIRECTION={NONE:xt.TOUCH_DIRECTION_NONE,YAW:xt.TOUCH_DIRECTION_YAW,PITCH:xt.TOUCH_DIRECTION_PITCH,ALL:xt.TOUCH_DIRECTION_ALL},t}(),Te=function(){var t=function(r){function o(t,e){var i;i=r.call(this)||this;var n=e||{};return i._el=t,i._rowCount=n.rowCount||1,i._colCount=n.colCount||1,i._totalCount=i._rowCount*i._colCount,i._width=n.width||"auto",i._height=n.height||"auto",i._autoHeight=null!=n.autoHeight?n.autoHeight:"true",i._colRow=[0,0],n.colRow?i._colRow=n.colRow:n.frameIndex&&i.setFrameIndex(n.frameIndex),i._el.style.width=o._getSizeString(i._width),i._el.style.height=o._getSizeString(i._height),n.imageUrl?(i._image=new Image,i._image.onload=function(){i._bg=o._createBgDiv(i._image,i._rowCount,i._colCount,i._autoHeight),i._el.appendChild(i._bg),i.setColRow(i._colRow[0],i._colRow[1]),i.trigger("load",{target:i._el,bgElement:i._bg}),i._autoPlayReservedInfo&&(i.play(i._autoPlayReservedInfo),i._autoPlayReservedInfo=null)},i._image.onerror=function(t){i.trigger("imageError",{imageUrl:n.imageUrl})},i._image.src=n.imageUrl,i):(setTimeout(function(){i.trigger("imageError",{imageUrl:n.imageUrl})},0),u(i))}d(o,r),o._createBgDiv=function(t,e,i,n){var r=document.createElement("div");r.style.position="relative",r.style.overflow="hidden",t.style.position="absolute",t.style.width=100*i+"%",t.style.height=100*e+"%",t.ondragstart=function(){return!1},p&&(t.style.willChange="transform"),r.appendChild(t);var o=t.width/i,a=t.height/e;if(n){var s=a/o;r.style.paddingBottom=100*s+"%"}else r.style.height="100%";return r};var t=o.prototype;return t.setFrameIndex=function(t){var e=this.toColRow(t);this.setColRow(e[0],e[1])},t.getFrameIndex=function(){return this._colRow[1]*this._colCount+this._colRow[0]},t.setColRow=function(t,e){e>this._rowCount-1||t>this._colCount-1||(this._image&&g&&(this._image.style[g]="translate("+-t/this._colCount*100+"%, "+-e/this._rowCount*100+"%)"),this._colRow=[t,e])},t.getColRow=function(){return this._colRow},o._getSizeString=function(t){return"number"==typeof t?t+"px":t},t.stop=function(){this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=null)},t.play=function(t){var e=this,i=void 0===t?{interval:1e3/this._totalCount,playCount:0}:t,n=i.interval,r=i.playCount;if(this._bg){this._autoPlayTimer&&(clearInterval(this._autoPlayTimer),this._autoPlayTimer=null);var o=this.getFrameIndex(),a=0,s=0;this._autoPlayTimer=setInterval(function(){o%=e._totalCount;var t=e.toColRow(o);e.setColRow(t[0],t[1]),o++,++s===e._totalCount&&(s=0,a++),0<r&&a===r&&clearInterval(e._autoPlayTimer)},n)}else this._autoPlayReservedInfo={interval:n,playCount:r}},t.toColRow=function(t){var e=this._colCount,i=this._rowCount;return t<0?[0,0]:t>=this._totalCount?[e-1,i-1]:[t%e,Math.floor(t/e)]},o}(e);return t.VERSION=vt,t}(),Ie=function(){var t=function(a){function t(t,e){var n;(n=a.call(this)||this)._el=t;var i=c({},e),r=i.colCount||1,o=i.rowCount||1;return n._scale=i.scale||1,n._panScale=.21*n._scale,n._frameCount=r*o,n._sprites=new Te(t,i).on({load:function(t){n.trigger("load",t)},imageError:function(t){n.trigger("imageError",{imageUrl:t.imageUrl})}}),n._panInput=new h.PanInput(n._el,{scale:[n._panScale,n._panScale]}),n._axes=new h({angle:{range:[0,359],circular:!0}}).on({change:function(t){var e=Math.floor(t.pos.angle/(360/n._frameCount)),i=n._frameCount-e-1;n._sprites.setFrameIndex(i),n.trigger("change",{frameIndex:i,colRow:n._sprites.getColRow(),angle:t.pos.angle})},animationEnd:function(t){n.trigger("animationEnd",{isTrusted:t.isTrusted})}}),n._axes.connect("angle",n._panInput),n}d(t,a);var e=t.prototype;return e.setScale=function(t){return isNaN(t)||t<0||(this._scale=t,this._panScale=.21*t,this._panInput.options.scale=[this._panScale,this._panScale]),this},e.getScale=function(){return this._scale},e.spinBy=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setBy({angle:t},e.duration),this},e.spinTo=function(t,e){return void 0===t&&(t=0),void 0===e&&(e={duration:0}),this._axes.setTo({angle:t},e.duration),this},e.getAngle=function(){return this._axes.get().angle||0},t}(e);return t.VERSION=vt,t}();t.PanoViewer=Re,t.SpinViewer=Ie,t.SpriteImage=Te,t.VERSION=vt,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=view360.min.js.map
